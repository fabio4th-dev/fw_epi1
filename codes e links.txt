fw_tools_2.0_rev01

https://fwtools2rev001.netlify.app/

Project URL:
https://azlgjkjzitbolyfyyaip.supabase.co


anon public:

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6bGdqa2p6aXRib2x5Znl5YWlwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0MTQ1NjcsImV4cCI6MjA4MTk5MDU2N30.PefjFNb5Phq2ZkR26-RlJdb-pnFUbYp1PxjYwI1LUpA


Lista Completa de Usu√°rios do Sistema
üë• Usu√°rios Cadastrados
1. F√°bio Mendes - N√≠vel DEV (Acesso Total)
Login: fabio@fwcompany.com.br

Senha: FabioFW123@

Perfil: dev

Permiss√µes: Acesso total a todas as funcionalidades

Acessos: Dashboard, Cadastro, Cat√°logo, Exportar, Banco de Dados

2. Emerson Silva - N√≠vel Almoxarife
Login: emerson.silva@fwcompany.com.br

Senha: EmersonFW1@

Perfil: almoxarife

Permiss√µes: Acesso parcial (sem configura√ß√£o de banco)

Acessos: Dashboard, Cadastro, Cat√°logo, Exportar

Configura√ß√£o Supabase: J√° pr√©-configurada

3. Usu√°rio Gen√©rico - N√≠vel B√°sico
Login: fwuser

Senha: User123

Perfil: user

Permiss√µes: Apenas consulta

Acessos: Dashboard, Cat√°logo (somente visualiza√ß√£o), Exportar

4. Raquel - N√≠vel Gen√©rico (Novo)
Login: raquel@fwcompany.com.br

Senha: RaqueL1234

Perfil: user

Permiss√µes: Apenas consulta

Acessos: Dashboard, Cat√°logo (somente visualiza√ß√£o), Exportar



<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ferramentas - Login</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #2980b9;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --gray-color: #95a5a6;
            --text-color: #2c3e50;
            --border-color: #bdc3c7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Login Container */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .login-box {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .login-box::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(25deg);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }
        
        .login-logo-fw {
            width: 180px;
            margin: 0 auto 20px;
        }
        
        .login-logo-fw img {
            width: 100%;
            height: auto;
        }
        
        .login-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .login-form {
            position: relative;
            z-index: 1;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: white;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .form-group input:focus {
            outline: none;
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .form-group input.error {
            border-color: var(--danger-color);
        }
        
        .login-btn {
            width: 100%;
            padding: 16px;
            background-color: white;
            color: var(--primary-color);
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .login-btn:hover {
            background-color: var(--light-color);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .login-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            position: relative;
            z-index: 1;
        }
        
        .login-logo-delservin {
            width: 120px;
        }
        
        .login-logo-altercon {
            width: 90px;
        }
        
        .login-footer img {
            width: 100%;
            height: auto;
        }
        
        .login-error {
            background-color: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--danger-color);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            position: relative;
            z-index: 1;
        }
        
        .login-error.show {
            display: block;
        }
        
        .user-badge {
            display: inline-block;
            padding: 4px 12px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 14px;
            margin-top: 5px;
        }
        
        /* Dashboard Container (mantendo estilo original) */
        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 12px;
            padding: 2px;
            margin-bottom: 5px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(25deg);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            position: relative;
            z-index: 1;
            margin-bottom: 2px;
        }
        
        .logo-fw {
            width: 140px;
            flex-shrink: 0;
            margin-left: 25px;
            position: relative;
            top: 42px;
        }
        
        .logo-fw img {
            width: 100%;
            height: auto;
            margin-left: 20px;
            margin-top: 10px;
            max-height: 650px;
            object-fit: contain;
        }
        
        .header-center {
            text-align: center;
            flex-grow: 1;
            padding: 0 20px;
        }
        
        .project-title {
            font-size: 40px;
            font-weight: 700;
            position: relative;
            left: 70px;
            z-index: 1;
            margin-bottom: 5px;
        }
        
        .project-subtitle {
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .header-right {
            display: flex;
            gap: 30px;
            flex-shrink: 0;
        }
        
        .logo-right {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-right img {
            width: 100%;
            height: auto;
            max-height: 60px;
            object-fit: contain;
        }
        
        .logo-delservin {
            width: 130px;
            position: relative;
            top: 38px;
            flex-shrink: 0;
        }
        
        .logo-altercon {
            width: 100px;
            position: relative;
            top: 38px;
            margin-right: 30px;
            flex-shrink: 0;
        }
        
        .user-info {
            position: absolute;
            top: 0px;
            right: 20px;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-welcome {
            color: white;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .project-info {
            display: flex;
            gap: 20px;
            position: relative;
            z-index: 1;
            align-items: center;
            justify-content: center;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .info-item {
            text-align: center;
            min-width: 100px;
        }
        
        .info-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .info-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .tabs-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .tabs-header {
            display: flex;
            background-color: var(--light-color);
            border-bottom: 1px solid var(--border-color);
            padding: 0 20px;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 18px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-color);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-button:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .tab-button.active {
            background-color: white;
            color: var(--secondary-color);
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--secondary-color);
        }
        
        .tab-button.hidden {
            display: none;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 22px;
            margin-bottom: 25px;
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--secondary-color);
        }
        
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 4px solid var(--secondary-color);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .card.hidden {
            display: none;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--secondary-color);
        }
        
        .progress-container {
            margin-bottom: 18px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: var(--light-color);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.8s ease;
        }
        
        .progress-fill.planned {
            background-color: var(--secondary-color);
        }
        
        .progress-fill.actual {
            background-color: var(--success-color);
        }
        
        .chart-container {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            height: 450px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-title i {
            color: var(--secondary-color);
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .status-completed {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
        }
        
        .status-ontrack {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary-color);
        }
        
        .status-delayed {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }
        
        /* Formul√°rio de cadastro - CORRE√á√ÉO APLICADA */
        .form-container {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-row-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-color); /* CORRE√á√ÉO: Cor definida explicitamente */
        }
        
        label.required::after {
            content: " *";
            color: var(--danger-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            transition: border 0.3s ease;
            background-color: white; /* CORRE√á√ÉO: Fundo branco expl√≠cito */
            color: var(--text-color); /* CORRE√á√ÉO: Cor do texto expl√≠cita */
        }
        
        input::placeholder, select::placeholder, textarea::placeholder {
            color: var(--gray-color); /* CORRE√á√ÉO: Placeholder vis√≠vel */
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        input.error, select.error, textarea.error {
            border-color: var(--danger-color);
            background-color: rgba(231, 76, 60, 0.05);
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--accent-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #219653;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* √Årea de captura de imagem */
        .image-capture-container {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .camera-area {
            width: 100%;
            height: 300px;
            background-color: var(--light-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .camera-area img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .camera-placeholder {
            text-align: center;
            color: var(--gray-color);
        }
        
        .camera-placeholder i {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .camera-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        /* Lista de ferramentas */
        .tools-list {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        th {
            background-color: var(--light-color);
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:hover {
            background-color: rgba(236, 240, 241, 0.5);
        }
        
        .tool-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            background-color: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .action-btn-view {
            color: var(--secondary-color);
        }
        
        .action-btn-edit {
            color: var(--warning-color);
        }
        
        .action-btn-delete {
            color: var(--danger-color);
        }
        
        .action-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }
        
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--gray-color);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Configura√ß√£o do banco de dados - CORRE√á√ÉO APLICADA */
        .config-container {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .config-step {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .config-step:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .step-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-title i {
            color: var(--secondary-color);
        }
        
        .step-content {
            margin-left: 35px;
        }
        
        .step-content p {
            color: var(--text-color); /* CORRE√á√ÉO: Cor do texto expl√≠cita */
            margin-bottom: 10px;
        }
        
        .step-content a {
            color: var(--secondary-color);
            text-decoration: none;
        }
        
        .step-content a:hover {
            text-decoration: underline;
        }
        
        .code-block {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            font-size: 14px;
        }
        
        .storage-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--gray-color);
        }
        
        .status-indicator.online {
            background-color: var(--success-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Responsividade */
        @media (max-width: 992px) {
            .header-top {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .logo-fw, .header-right {
                width: 100%;
                justify-content: center;
            }
            
            .header-center {
                padding: 0;
            }
            
            .project-info {
                gap: 15px;
            }
            
            .info-item {
                min-width: 80px;
            }
            
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-top: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .tabs-header {
                justify-content: center;
            }
            
            .btn-group {
                justify-content: center;
            }
            
            .step-content {
                margin-left: 0;
            }
            
            .header-right {
                gap: 15px;
            }
            
            .logo-delservin {
                width: 100px;
            }
            
            .logo-altercon {
                width: 80px;
            }
            
            table {
                font-size: 13px;
            }
            
            th, td {
                padding: 10px 8px;
            }
            
            .login-box {
                padding: 30px 20px;
            }
            
            .login-title {
                font-size: 28px;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-container {
                padding: 10px;
            }
            
            .tab-content {
                padding: 15px;
            }
            
            .section-title {
                font-size: 18px;
            }
            
            .card {
                padding: 15px;
            }
            
            .btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .camera-controls {
                flex-wrap: wrap;
            }
            
            .login-box {
                padding: 25px 15px;
            }
            
            .login-title {
                font-size: 24px;
            }
        }
        
        /* Notifica√ß√µes */
        .notification {
            position: fixed;
            top: 150px;
            right: 20px;
            padding: 10px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1100;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }
        
        .notification-success {
            background-color: var(--success-color);
        }
        
        .notification-error {
            background-color: var(--danger-color);
        }
        
        .notification-warning {
            background-color: var(--warning-color);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Loader */
        .loader {
            display: none;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Info de armazenamento */
        .storage-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .storage-info p {
            margin: 5px 0;
            font-size: 14px;
            color: var(--text-color); /* CORRE√á√ÉO: Cor do texto expl√≠cita */
        }
        
        .storage-info .storage-type {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--light-color);
            border-radius: 4px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .storage-info.hidden {
            display: none;
        }
        
        .export-history {
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* Backup Button */
        .backup-btn {
            background-color: #8e44ad;
            color: white;
        }
        
        .backup-btn:hover {
            background-color: #7d3c98;
        }
        
        /* Search Box */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-box input {
            padding-left: 40px;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }
        
        /* Tool Status Colors */
        .status-available { color: var(--success-color); }
        .status-inuse { color: var(--secondary-color); }
        .status-maintenance { color: var(--warning-color); }
        .status-damaged { color: var(--danger-color); }
        
        /* QR Code Styles */
        .qrcode-container {
            text-align: center;
            padding: 20px;
        }
        
        .qrcode-container canvas {
            max-width: 200px;
            max-height: 200px;
            margin: 0 auto 20px;
        }
        
        /* Number input spinner */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
            height: 30px;
        }
        
        /* Money input */
        .money-input {
            position: relative;
        }
        
        .money-input::before {
            content: "R$";
            position: absolute;
            left: 12px;
            top: 12px;
            color: var(--gray-color);
        }
        
        .money-input input {
            padding-left: 40px;
        }
        
        /* Compact table view */
        .compact-view .action-buttons {
            flex-direction: column;
            gap: 4px;
        }
        
        /* Stock indicators */
        .stock-low {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .stock-normal {
            color: var(--success-color);
        }
        
        .stock-high {
            color: var(--warning-color);
        }
        
        /* Footer */
        .site-footer {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: 40px;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-version {
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* CORRE√á√ïES ESPEC√çFICAS PARA OS PROBLEMAS RELATADOS */
        
        /* Garantir que todos os textos dentro dos containers sejam leg√≠veis */
        .config-container p,
        .config-container label,
        .config-container .form-group label {
            color: var(--text-color) !important;
        }
        
        /* Configurar inputs na aba de Banco de Dados */
        .config-container input,
        .config-container select {
            background-color: white !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }
        
        .config-container input::placeholder {
            color: var(--gray-color) !important;
        }
        
        /* Labels na aba de configura√ß√£o do banco */
        .config-container .form-group label {
            color: var(--primary-color) !important;
            font-weight: 500;
        }
        
        /* T√≠tulos nas se√ß√µes */
        .form-container h4,
        .config-step h4.step-title {
            color: var(--primary-color) !important;
        }
        
        /* Texto explicativo nas configura√ß√µes */
        .step-content p,
        .config-step p {
            color: var(--text-color) !important;
            opacity: 1 !important;
        }
        
        /* Garantir que links sejam vis√≠veis */
        .step-content a {
            color: var(--secondary-color) !important;
        }
        
        /* ========= CORRE√á√ïES ADICIONAIS ========= */
        /* CORRE√á√ïES ESPEC√çFICAS PARA OS PROBLEMAS RELATADOS */
        
        /* 1. CORRE√á√ÉO PARA ABAS 'CADASTRAR ITEM' E 'BANCO DE DADOS' */
        #cadastro .form-container,
        #cadastro .image-capture-container,
        #database .config-container {
            background-color: white !important;
        }
        
        /* 2. CORRE√á√ÉO PARA TEXTOS TRANSPARENTES */
        #cadastro label,
        #cadastro .form-group label,
        #cadastro .section-title,
        #cadastro h4,
        #database .config-step .step-content p,
        #database .config-step .step-content label,
        #database .step-title {
            color: var(--text-color) !important;
            opacity: 1 !important;
            font-weight: 500 !important;
        }
        
        /* 3. CORRE√á√ÉO PARA CAIXAS DE SELE√á√ÉO E INPUTS INVIS√çVEIS */
        #cadastro input,
        #cadastro select,
        #cadastro textarea,
        #database input,
        #database select {
            background-color: white !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        /* 4. CORRE√á√ÉO PARA PLACEHOLDERS VIS√çVEIS */
        #cadastro input::placeholder,
        #cadastro select::placeholder,
        #cadastro textarea::placeholder,
        #database input::placeholder {
            color: var(--gray-color) !important;
            opacity: 0.8 !important;
        }
        
        /* 5. ESTILO ESPEC√çFICO PARA SELECTS (CAIXAS DE SELE√á√ÉO) */
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232c3e50' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right 12px center !important;
            background-size: 16px !important;
            padding-right: 40px !important;
        }
        
        /* 6. CORRE√á√ÉO PARA TODOS OS INPUTS DO SISTEMA */
        input, select, textarea {
            background-color: white !important;
            color: var(--text-color) !important;
            border: 1px solid var(--border-color) !important;
        }
        
        /* 7. REMOVER TRANSPAR√äNCIA DO SISTEMA */
        @media (prefers-reduced-transparency: reduce) {
            * {
                opacity: 1 !important;
                background-color: white !important;
            }
            
            input, select, textarea {
                background-color: white !important;
                opacity: 1 !important;
            }
        }
        
        /* 8. CORRE√á√ÉO ESPEC√çFICA PARA A ABA DE CADASTRO */
        #cadastro .form-group label.required {
            color: var(--primary-color) !important;
        }
        
        #cadastro .form-group label.required::after {
            color: var(--danger-color) !important;
        }
        
        /* 9. GARANTIR CONTRASTE ADEQUADO EM TODOS OS ELEMENTOS */
        #cadastro,
        #database {
            background-color: white !important;
        }
        
        #cadastro *:not(.btn):not(.notification):not(.status-badge):not(.tab-button),
        #database *:not(.btn):not(.notification):not(.status-badge):not(.tab-button) {
            color: var(--text-color) !important;
        }
    </style>
</head>
<body>
    <!-- Login Screen (Inicial) -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <div class="login-logo-fw">
                    <img src="FW Logo.png" alt="FW Logo">
                </div>
                <h1 class="login-title">Sistema de Controle de Ferramentas</h1>
                <p class="login-subtitle">Fa√ßa login para acessar o sistema</p>
            </div>
            
            <div class="login-error" id="loginError">
                <i class="fas fa-exclamation-circle"></i> Credenciais inv√°lidas. Tente novamente.
            </div>
            
            <div class="login-form">
                <div class="form-group">
                    <label for="loginEmail">Email ou Usu√°rio</label>
                    <input type="text" id="loginEmail" placeholder="Digite seu email ou usu√°rio">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Senha</label>
                    <input type="password" id="loginPassword" placeholder="Digite sua senha">
                </div>
                
                <button type="button" class="login-btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                </button>
                
                <div style="margin-top: 20px; text-align: center;">
                    <p style="font-size: 14px; opacity: 0.9;">Credenciais de exemplo:</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                        <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                            <span style="font-size: 12px; display: block;">DEV (Acesso Total)</span>
                            <span style="font-size: 11px;">fabio@fwcompany.com.br / FabioFW123@</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                            <span style="font-size: 12px; display: block;">Almoxarife</span>
                            <span style="font-size: 11px;">emerson.silva@fwcompany.com.br / EmersonFW1@</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                            <span style="font-size: 12px; display: block;">Usu√°rio Gen√©rico</span>
                            <span style="font-size: 11px;">fwuser / User123</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="login-footer">
                <div class="login-logo-delservin">
                    <img src="Delservin Logo.png" alt="Delservin Logo">
                </div>
                <div class="login-logo-altercon">
                    <img src="Altercon Logo.png" alt="Altercon Logo">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Dashboard Screen (Ap√≥s Login) -->
    <div id="dashboardScreen" class="dashboard-container" style="display: none;">
        <header class="dashboard-header">
            <div class="user-info">
                <div class="user-welcome">
                    <i class="fas fa-user"></i>
                    <span id="userWelcomeText">Bem-vindo!</span>
                    <span class="user-badge" id="userRoleBadge">DEV</span>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
            
            <div class="header-top">
                <div class="logo-fw">
                    <img src="FW Logo.png" alt="FW Logo">
                </div>
                
                <div class="header-center">
                    <h1 class="project-title">Sistema de Controle de Ferramentas</h1>                    
                </div>
                
                <div class="header-right">
                    <div class="logo-right logo-delservin">
                        <img src="Delservin Logo.png" alt="Delservin Logo">
                    </div>
                    <div class="logo-right logo-altercon">
                        <img src="Altercon Logo.png" alt="Altercon Logo">
                    </div>
                </div>
            </div>
            
            <div class="project-info">
                <div class="info-item">
                    <div class="info-label">Total de Itens</div>
                    <div class="info-value" id="totalTools">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Valor Total</div>
                    <div class="info-value" id="totalValue">R$ 0,00</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Status</div>
                    <div class="info-value">
                        <span class="status-badge status-ontrack" id="storageStatus">Local</span>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">Cloud</div>
                    <div class="info-value">
                        <span class="status-badge status-delayed" id="indexedDBStatus">Desconectado</span>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">√öltima Atualiza√ß√£o</div>
                    <div class="info-value" id="lastUpdate">Hoje</div>
                </div>
            </div>
        </header>
        
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-button active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="tab-button" data-tab="cadastro" id="cadastroTab">
                    <i class="fas fa-tools"></i> Cadastrar Item
                </button>
                <button class="tab-button" data-tab="catalogo">
                    <i class="fas fa-list"></i> Cat√°logo de Itens
                </button>
                <button class="tab-button" data-tab="exportar">
                    <i class="fas fa-file-excel"></i> Exportar
                </button>
                <button class="tab-button" data-tab="database" id="databaseTab">
                    <i class="fas fa-database"></i> Banco de Dados
                </button>
            </div>
            
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2 class="section-title"><i class="fas fa-chart-line"></i> Estat√≠sticas do Sistema</h2>
                
                <div class="cards-container">
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-boxes"></i> Status dos Itens</h3>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Dispon√≠veis</span>
                                <span id="availablePercent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill actual" id="availableBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Em Uso</span>
                                <span id="inUsePercent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill planned" id="inUseBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Manuten√ß√£o</span>
                                <span id="maintenancePercent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="maintenanceBar" style="width: 0%; background-color: var(--warning-color)"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Danificados</span>
                                <span id="damagedPercent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="damagedBar" style="width: 0%; background-color: var(--danger-color)"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-money-bill-wave"></i> Valor por Categoria</h3>
                        <div id="valueStats">
                            <p style="text-align: center; color: var(--gray-color); padding: 20px 0;">Carregando dados...</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-exclamation-triangle"></i> Itens com Estoque Baixo</h3>
                        <div id="lowStockItems">
                            <p style="text-align: center; color: var(--gray-color); padding: 20px 0;">Carregando dados...</p>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Distribui√ß√£o por Localiza√ß√£o</h3>
                    <canvas id="locationChart"></canvas>
                </div>
                
                <div class="card" id="backupCard">
                    <h3 class="card-title"><i class="fas fa-download"></i> Backup R√°pido</h3>
                    <p style="margin-bottom: 15px;">Fa√ßa um backup completo dos seus dados localmente.</p>
                    <div class="btn-group">
                        <button type="button" class="btn backup-btn" id="backupBtn">
                            <i class="fas fa-download"></i> Fazer Backup
                        </button>
                        <button type="button" class="btn btn-warning" id="restoreBtn">
                            <i class="fas fa-upload"></i> Restaurar Backup
                        </button>
                    </div>
                    <input type="file" id="restoreFileInput" accept=".json" style="display: none;">
                </div>
            </div>
            
            <!-- Cadastro Tab -->
            <div id="cadastro" class="tab-content">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Cadastrar Novo Item</h2>
                
                <div class="form-container">
                    <form id="toolForm">
                        <h4 style="color: var(--primary-color); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--light-color);">
                            <i class="fas fa-info-circle"></i> Informa√ß√µes B√°sicas
                        </h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="toolName" class="required">Nome do Produto</label>
                                <input type="text" id="toolName" required maxlength="200" placeholder="Ex: Martelo de Borracha">
                                <div class="error-message" id="toolNameError">O nome do produto √© obrigat√≥rio</div>
                            </div>
                            <div class="form-group">
                                <label for="toolCode" class="required">C√≥digo</label>
                                <input type="text" id="toolCode" required maxlength="50" placeholder="Ex: MART-001">
                                <div class="error-message" id="toolCodeError">O c√≥digo √© obrigat√≥rio</div>
                            </div>
                            <div class="form-group">
                                <label for="patrimonioNumber">N√∫mero do Patrim√¥nio</label>
                                <input type="text" id="patrimonioNumber" maxlength="50" placeholder="Ex: PAT-2023-001">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ncmCode">N.C.M. (Nomenclatura Comum do Mercosul)</label>
                                <input type="text" id="ncmCode" maxlength="20" placeholder="Ex: 8205.70.00 (opcional)">
                            </div>
                            <div class="form-group">
                                <label for="toolCategory" class="required">Categoria</label>
                                <select id="toolCategory" required>
                                    <option value="">Selecione uma categoria</option>
                                    <option value="Ferramentas El√©tricas">Ferramentas El√©tricas</option>
                                    <option value="Ferramentas Manuais">Ferramentas Manuais</option>
                                    <option value="Equipamentos de Seguran√ßa">Equipamentos de Seguran√ßa</option>
                                    <option value="M√°quinas">M√°quinas</option>
                                    <option value="Material de Consumo">Material de Consumo</option>
                                    <option value="EPI">EPI (Equipamento de Prote√ß√£o Individual)</option>
                                    <option value="Inform√°tica">Inform√°tica</option>
                                    <option value="Ve√≠culos">Ve√≠culos</option>
                                    <option value="Outros">Outros</option>
                                </select>
                                <div class="error-message" id="toolCategoryError">Selecione uma categoria</div>
                            </div>
                            <div class="form-group">
                                <label for="toolStatus" class="required">Status</label>
                                <select id="toolStatus" required>
                                    <option value="Dispon√≠vel">Dispon√≠vel</option>
                                    <option value="Em Uso">Em Uso</option>
                                    <option value="Manuten√ß√£o">Em Manuten√ß√£o</option>
                                    <option value="Danificado">Danificado</option>
                                    <option value="Reservado">Reservado</option>
                                    <option value="Descartado">Descartado</option>
                                </select>
                                <div class="error-message" id="toolStatusError">Selecione um status</div>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--primary-color); margin: 30px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid var(--light-color);">
                            <i class="fas fa-map-marker-alt"></i> Localiza√ß√£o e Condi√ß√£o
                        </h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="toolLocation" class="required">Localiza√ß√£o</label>
                                <select id="toolLocation" required>
                                    <option value="">Selecione uma localiza√ß√£o</option>
                                    <option value="Almoxarifado Central">Almoxarifado Central</option>
                                    <option value="Container Mec√¢nica">Container Mec√¢nica</option>
                                    <option value="Container El√©trica">Container El√©trica</option>
                                    <option value="Oficina">Oficina</option>
                                    <option value="Campo">Campo</option>
                                    <option value="Caminh√£o">Caminh√£o</option>
                                    <option value="Kombi de Servi√ßo">Kombi de Servi√ßo</option>
                                    <option value="Escrit√≥rio">Escrit√≥rio</option>                                    
                                    <option value="Dep√≥sito">Dep√≥sito</option>
                                </select>
                                <div class="error-message" id="toolLocationError">Selecione uma localiza√ß√£o</div>
                            </div>
                            <div class="form-group">
                                <label for="toolCondition" class="required">Condi√ß√£o</label>
                                <select id="toolCondition" required>
                                    <option value="Novo">Novo</option>
                                    <option value="Bom">Bom</option>
                                    <option value="Regular">Regular</option>
                                    <option value="Precisa de Reparo">Precisa de Reparo</option>
                                    <option value="Inutiliz√°vel">Inutiliz√°vel</option>
                                </select>
                                <div class="error-message" id="toolConditionError">Selecione uma condi√ß√£o</div>
                            </div>
                            <div class="form-group">
                                <label for="notaFiscal">N¬∫ da Nota Fiscal</label>
                                <input type="text" id="notaFiscal" maxlength="50" placeholder="Ex: NF-2023-001234">
                            </div>
                        </div>
                        
                        <h4 style="color: var(--primary-color); margin: 30px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid var(--light-color);">
                            <i class="fas fa-calculator"></i> Dados Financeiros e Estoque
                        </h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="unidadeMedida">Unidade de Medida</label>
                                <select id="unidadeMedida">
                                    <option value="UN">UN (Unidade)</option>
                                    <option value="PC">PC (Pe√ßa)</option>
                                    <option value="CX">CX (Caixa)</option>
                                    <option value="KG">KG (Quilograma)</option>
                                    <option value="M">M (Metro)</option>
                                    <option value="L">L (Litro)</option>
                                    <option value="PAR">PAR (Par)</option>
                                    <option value="JGO">JGO (Jogo)</option>
                                    <option value="HR">HR (Hora)</option>
                                </select>
                            </div>
                            <div class="form-group money-input">
                                <label for="preco">Pre√ßo Unit√°rio (R$)</label>
                                <input type="number" id="preco" min="0" step="0.01" placeholder="0,00">
                            </div>
                            <div class="form-group">
                                <label for="quantidadeAtual">Quantidade Atual</label>
                                <input type="number" id="quantidadeAtual" min="0" value="1">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="estoqueMinimo">Estoque M√≠nimo</label>
                                <input type="number" id="estoqueMinimo" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label for="estoqueMaximo">Estoque M√°ximo</label>
                                <input type="number" id="estoqueMaximo" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label for="dataCadastro">Data do Cadastro</label>
                                <input type="date" id="dataCadastro" value="">
                            </div>
                        </div>
                        
                        <h4 style="color: var(--primary-color); margin: 30px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid var(--light-color);">
                            <i class="fas fa-align-left"></i> Descri√ß√µes e Observa√ß√µes
                        </h4>
                        
                        <div class="form-group">
                            <label for="toolDescription">Descri√ß√£o Detalhada</label>
                            <textarea id="toolDescription" rows="3" maxlength="1000" placeholder="Descreva detalhadamente o produto..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="toolObservations">Observa√ß√µes</label>
                            <textarea id="toolObservations" rows="2" maxlength="500" placeholder="Observa√ß√µes adicionais..."></textarea>
                        </div>
                    </form>
                </div>
                
                <div class="image-capture-container" id="imageCaptureContainer">
                    <h3 class="section-title"><i class="fas fa-camera"></i> Fotografar Item</h3>
                    
                    <div class="camera-area" id="cameraArea">
                        <div class="camera-placeholder" id="cameraPlaceholder">
                            <i class="fas fa-camera"></i>
                            <p>Nenhuma imagem selecionada</p>
                        </div>
                        <img id="toolImagePreview" style="display: none;">
                    </div>
                    
                    <div class="camera-controls">
                        <button type="button" class="btn btn-primary" id="captureImageBtn">
                            <i class="fas fa-camera"></i> Tirar Foto
                        </button>
                        <button type="button" class="btn btn-warning" id="uploadImageBtn">
                            <i class="fas fa-upload"></i> Carregar Imagem
                        </button>
                        <button type="button" class="btn btn-danger" id="clearImageBtn">
                            <i class="fas fa-trash"></i> Remover Imagem
                        </button>
                    </div>
                    <p style="text-align: center; margin-top: 10px; color: var(--gray-color); font-size: 12px;">
                        Tamanho m√°ximo: 5MB | Formatos: JPG, PNG, GIF
                    </p>
                </div>
                
                <div class="btn-group">
                    <button type="button" class="btn btn-success" id="saveToolBtn">
                        <i class="fas fa-save"></i> Salvar Item
                    </button>
                    <button type="button" class="btn btn-primary" id="saveAndNewBtn">
                        <i class="fas fa-plus-circle"></i> Salvar e Novo
                    </button>
                    <button type="button" class="btn btn-warning" id="clearFormBtn">
                        <i class="fas fa-eraser"></i> Limpar Formul√°rio
                    </button>
                    <button type="button" class="btn backup-btn" id="generateQRCodeBtn">
                        <i class="fas fa-qrcode"></i> Gerar QR Code
                    </button>
                </div>
            </div>
            
            <!-- Cat√°logo Tab -->
            <div id="catalogo" class="tab-content">
                <h2 class="section-title"><i class="fas fa-list"></i> Cat√°logo de Itens</h2>
                
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchTool" placeholder="Buscar por nome, c√≥digo, patrim√¥nio ou categoria...">
                </div>
                
                <div class="btn-group" style="margin-bottom: 20px;">
                    <button type="button" class="btn btn-primary" id="filterAllBtn">
                        <i class="fas fa-filter"></i> Todos
                    </button>
                    <button type="button" class="btn btn-success" id="filterAvailableBtn">
                        <i class="fas fa-check-circle"></i> Dispon√≠veis
                    </button>
                    <button type="button" class="btn btn-warning" id="filterInUseBtn">
                        <i class="fas fa-user-check"></i> Em Uso
                    </button>
                    <button type="button" class="btn btn-danger" id="filterLowStockBtn">
                        <i class="fas fa-exclamation-triangle"></i> Estoque Baixo
                    </button>
                    <button type="button" class="btn btn-secondary" id="syncFromOnlineBtn">
                        <i class="fas fa-cloud-upload-alt"></i> Enviar para a Nuvem
                    </button>
                </div>
                
                <div class="tools-list">
                    <div class="table-container">
                        <table id="toolsTable">
                            <thead>
                                <tr>
                                    <th>QR Code</th>
                                    <th>C√≥digo</th>
                                    <th>Nome do Produto</th>
                                    <th>Patrim√¥nio</th>
                                    <th>Categoria</th>
                                    <th>Status</th>
                                    <th>Localiza√ß√£o</th>
                                    <th>Condi√ß√£o</th>
                                    <th>Unidade</th>
                                    <th>Estoque</th>
                                    <th>Pre√ßo (R$)</th>
                                    <th>Data Cad.</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="toolsTableBody">
                                <tr id="noToolsRow">
                                    <td colspan="13" style="text-align: center; padding: 40px; color: var(--gray-color);">
                                        Nenhum item cadastrado. Clique em "Cadastrar Item" para adicionar.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="storage-info" id="storageInfo">
                    <p><strong>Informa√ß√µes de Armazenamento:</strong></p>
                    <p id="storageInfoText">Carregando informa√ß√µes...</p>
                    <div class="btn-group" style="margin-top: 10px;">
                        <button type="button" class="btn btn-sm btn-warning" id="clearCacheBtn">
                            <i class="fas fa-trash-alt"></i> Limpar Cache Local
                        </button>
                        <button type="button" class="btn btn-sm btn-primary" id="optimizeStorageBtn">
                            <i class="fas fa-compress-alt"></i> Otimizar Armazenamento
                        </button>
                        <button type="button" class="btn btn-sm backup-btn" id="quickBackupBtn">
                            <i class="fas fa-download"></i> Backup R√°pido
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Exportar Tab -->
            <div id="exportar" class="tab-content">
                <h2 class="section-title"><i class="fas fa-file-excel"></i> Exportar Dados</h2>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-download"></i> Exportar Dados</h3>
                    <p style="margin-bottom: 20px;">Exporte todos os itens cadastrados para um arquivo Excel. O arquivo incluir√° todas as informa√ß√µes.</p>
                    
                    <div class="form-group">
                        <label for="exportRange">Exportar</label>
                        <select id="exportRange" class="form-control">
                            <option value="all">Todos os itens</option>
                            <option value="available">Apenas dispon√≠veis</option>
                            <option value="inuse">Apenas em uso</option>
                            <option value="maintenance">Apenas em manuten√ß√£o</option>
                            <option value="lowstock">Apenas estoque baixo</option>
                        </select>
                    </div>
                    
                    <div class="loader" id="exportLoader"></div>
                    
                    <div class="btn-group" style="margin-top: 20px;">
                        <button type="button" class="btn btn-success" id="exportExcelBtn">
                            <i class="fas fa-file-excel"></i> Exportar para Excel
                        </button>
                        <button type="button" class="btn btn-primary" id="exportCSVBtn">
                            <i class="fas fa-file-csv"></i> Exportar para CSV
                        </button>
                        <button type="button" class="btn backup-btn" id="exportJSONBtn">
                            <i class="fas fa-file-code"></i> Exportar para JSON
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-history"></i> Hist√≥rico de Exporta√ß√µes</h3>
                    <div class="export-history" id="exportHistory">
                        <p style="text-align: center; color: var(--gray-color); padding: 20px 0;">
                            Nenhuma exporta√ß√£o realizada ainda
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Banco de Dados Online Tab -->
            <div id="database" class="tab-content">
                <h2 class="section-title"><i class="fas fa-database"></i> Banco de Dados Online Gratuito</h2>
                
                <div class="config-container">
                    <div class="storage-status">
                        <div class="status-indicator" id="dbStatusIndicator"></div>
                        <h3 id="dbStatusText">Status: Armazenamento Local</h3>
                    </div>
                    
                    <div class="config-step">
                        <h4 class="step-title"><i class="fas fa-cloud"></i> Passo 1: Criar Conta Gratuita no Supabase</h4>
                        <div class="step-content">
                            <p>1. Acesse <a href="https://supabase.com" target="_blank">supabase.com</a></p>
                            <p>2. Clique em "Start your project"</p>
                            <p>3. Fa√ßa login com sua conta GitHub, Google ou email</p>
                            <p>4. Crie um novo projeto (√© gratuito!)</p>
                        </div>
                    </div>
                    
                    <div class="config-step">
                        <h4 class="step-title"><i class="fas fa-table"></i> Passo 2: Criar Tabela no Banco de Dados</h4>
                        <div class="step-content">
                            <p>No painel do Supabase, v√° para "Table Editor" e crie esta tabela SQL:</p>
                            <div class="code-block">
-- TABELA COMPLETA PARA SISTEMA DE FERRAMENTAS
CREATE TABLE IF NOT EXISTS tools (
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    code TEXT NOT NULL UNIQUE,
    patrimonio TEXT,
    ncm TEXT NOT NULL,
    category TEXT NOT NULL,
    status TEXT NOT NULL,
    location TEXT NOT NULL,
    condition TEXT NOT NULL,
    nota_fiscal TEXT,
    unidade TEXT,
    preco NUMERIC(10,2),
    quantidade INTEGER DEFAULT 1,
    estoque_minimo INTEGER DEFAULT 0,
    estoque_maximo INTEGER DEFAULT 0,
    description TEXT,
    observations TEXT,
    image_url TEXT,
    data_cadastro DATE DEFAULT CURRENT_DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
                            </div>
                            <button type="button" class="btn btn-primary" id="createTableBtn">
                                <i class="fas fa-plus-circle"></i> Criar Tabela Automaticamente
                            </button>
                            <div id="tableCreationResult" style="margin-top: 10px;"></div>
                        </div>
                    </div>
                    
                    <div class="config-step">
                        <h4 class="step-title"><i class="fas fa-key"></i> Passo 3: Configurar Chaves de API</h4>
                        <div class="step-content">
                            <p>No painel do Supabase, v√° para "Settings" ‚Üí "API" e copie:</p>
                            
                            <div class="form-group">
                                <label for="supabaseUrl">URL do Projeto</label>
                                <input type="text" id="supabaseUrl" placeholder="https://seu-projeto.supabase.co">
                            </div>
                            
                            <div class="form-group">
                                <label for="supabaseKey">Chave da API (anon/public)</label>
                                <input type="text" id="supabaseKey" placeholder="sua-chave-publica-aqui">
                            </div>
                            
                            <div class="btn-group">
                                <button type="button" class="btn btn-success" id="saveConfigBtn">
                                    <i class="fas fa-save"></i> Salvar Configura√ß√£o
                                </button>
                                <button type="button" class="btn btn-primary" id="testConnectionBtn">
                                    <i class="fas fa-plug"></i> Testar Conex√£o
                                </button>
                                <button type="button" class="btn btn-warning" id="resetConfigBtn">
                                    <i class="fas fa-redo"></i> Redefinir Configura√ß√£o
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-step">
                        <h4 class="step-title"><i class="fas fa-sync-alt"></i> Passo 4: Sincronizar Dados</h4>
                        <div class="step-content">
                            <p>Sincronize seus dados locais com o banco de dados online:</p>
                            <div class="btn-group">
                                <button type="button" class="btn btn-success" id="syncToOnlineBtn">
                                    <i class="fas fa-cloud-upload-alt"></i> Enviar para Nuvem
                                </button>
                                <button type="button" class="btn btn-primary" id="syncFromOnlineBtn2">
                                    <i class="fas fa-cloud-download-alt"></i> Buscar da Nuvem
                                </button>
                                <button type="button" class="btn btn-warning" id="syncBothBtn">
                                    <i class="fas fa-exchange-alt"></i> Sincronizar Ambos
                                </button>
                            </div>
                            
                            <div class="storage-info" style="margin-top: 15px;">
                                <p><strong>Configura√ß√£o de Sincroniza√ß√£o:</strong></p>
                                <div class="form-group">
                                    <label for="syncLimit">Limite de itens por sincroniza√ß√£o:</label>
                                    <select id="syncLimit" class="form-control">
                                        <option value="50">50 itens</option>
                                        <option value="100" selected>100 itens</option>
                                        <option value="200">200 itens</option>
                                        <option value="500">500 itens</option>
                                        <option value="0">Todos (n√£o recomendado)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title"><i class="fas fa-info-circle"></i> Informa√ß√µes do Banco de Dados</h3>
                    <div id="dbInfo">
                        <p style="text-align: center; color: var(--gray-color); padding: 20px 0;">
                            Configure o banco de dados para ver informa√ß√µes aqui
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal para visualizar item -->
        <div id="toolModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Detalhes do Item</h3>
                    <button class="modal-close" id="closeModalBtn">&times;</button>
                </div>
                <div class="modal-body" id="toolModalBody">
                    <!-- Conte√∫do do modal ser√° preenchido via JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Modal QR Code -->
        <div id="qrModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">QR Code do Item</h3>
                    <button class="modal-close" id="closeQRModalBtn">&times;</button>
                </div>
                <div class="modal-body" id="qrModalBody">
                    <!-- QR Code ser√° gerado aqui -->
                </div>
            </div>
        </div>
        
        <!-- Input para upload de imagem (oculto) -->
        <input type="file" id="imageUploadInput" accept="image/*" capture="environment" style="display: none;">
        
        <!-- Input para restaurar backup (oculto) -->
        <input type="file" id="restoreFileInput" accept=".json" style="display: none;">
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <p>Desenvolvido por F√°bio Mendes Rodrigues, Planejador da F.W. Company</p>
            <p class="footer-version">Vers√£o 1.0_rev03 | √öltima atualiza√ß√£o: <span id="currentDate"></span></p>
        </div>
    </footer>

    <script>
        // ============================================
        // SISTEMA DE AUTENTICA√á√ÉO E GERENCIAMENTO
        // ============================================

        // Dados de usu√°rios
        const users = {
            // DEV - Acesso total
            'fabio@fwcompany.com.br': {
                password: 'FabioFW123@',
                role: 'dev',
                name: 'F√°bio Mendes',
                email: 'fabio@fwcompany.com.br'
            },
            
            // Almoxarife - Acesso Dashboard, Cadastro, Cat√°logo, Exportar
            'emerson.silva@fwcompany.com.br': {
                password: 'EmersonFW1@',
                role: 'almoxarife',
                name: 'Emerson Silva',
                email: 'emerson.silva@fwcompany.com.br',
                supabaseConfig: {
                    url: 'https://azlgjkjzitbolyfyyaip.supabase.co',
                    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6bGdqa2p6aXRib2x5Znl5YWlwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0MTQ1NjcsImV4cCI6MjA4MTk5MDU2N30.PefjFNb5Phq2ZkR26-RlJdb-pnFUbYp1PxjYwI1LUpA'
                }
            },
            
            // Usu√°rio Gen√©rico - Apenas consulta
            'fwuser': {
                password: 'User123',
                role: 'user',
                name: 'Usu√°rio Gen√©rico',
                email: 'fwuser@fwcompany.com.br'
            },
            // ‚Üê ADICIONE AQUI O NOVO USU√ÅRIO ‚Üì
            'raquel@fwcompany.com.br': {
                password: 'RaqueL1234',
                role: 'user',  // N√≠vel gen√©rico (apenas consulta)
                name: 'Raquel',
                email: 'raquel@fwcompany.com.br'
    }
        };

        // Estado da aplica√ß√£o
        let currentUser = null;
        let tools = [];
        let currentToolImage = null;
        let chartInstance = null;
        let isEditing = false;
        let editingToolId = null;
        let supabaseClient = null;
        let isOnlineMode = false;
        let currentStorageType = 'localStorage';

        // Configura√ß√£o do Supabase padr√£o
        const SUPABASE_URL = 'https://seu-projeto.supabase.co';
        const SUPABASE_ANON_KEY = 'sua-chave-publica-aqui';

        // Configura√ß√µes locais
        let dbConfig = {
            url: SUPABASE_URL,
            key: SUPABASE_ANON_KEY
        };

        // ============================================
        // FUN√á√ïES DE AUTENTICA√á√ÉO
        // ============================================

        // Fun√ß√£o de login
        function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            // Verificar credenciais
            let user = null;
            let userKey = null;
            
            // Verificar por email
            if (users[email]) {
                user = users[email];
                userKey = email;
            }
            
            // Se n√£o encontrou por email, tentar por nome de usu√°rio
            if (!user && email === 'fwuser') {
                user = users['fwuser'];
                userKey = 'fwuser';
            }
            
            if (user && user.password === password) {
                // Login bem-sucedido
                currentUser = {
                    ...user,
                    key: userKey
                };
                
                // Salvar sess√£o
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Configurar dbConfig baseado no usu√°rio
                if (user.supabaseConfig) {
                    dbConfig = user.supabaseConfig;
                    localStorage.setItem('supabaseConfig', JSON.stringify(dbConfig));
                } else {
                    const savedConfig = localStorage.getItem('supabaseConfig');
                    if (savedConfig) {
                        dbConfig = JSON.parse(savedConfig);
                    }
                }
                
                // Mostrar dashboard
                showDashboard();
                
                // Configurar interface baseada no perfil
                setupUserInterface();
                
                // Inicializar sistema
                initializeSystem();
                
            } else {
                // Login falhou
                errorDiv.classList.add('show');
                setTimeout(() => {
                    errorDiv.classList.remove('show');
                }, 3000);
            }
        }

        // Logout
        function logout() {
            if (confirm('Deseja realmente sair do sistema?')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                showLogin();
            }
        }

        // Verificar sess√£o ativa
        function checkSession() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    
                    // Verificar se o usu√°rio ainda existe
                    if (users[currentUser.key] && users[currentUser.key].password === currentUser.password) {
                        // Configurar dbConfig
                        if (currentUser.supabaseConfig) {
                            dbConfig = currentUser.supabaseConfig;
                        } else {
                            const savedConfig = localStorage.getItem('supabaseConfig');
                            if (savedConfig) {
                                dbConfig = JSON.parse(savedConfig);
                            }
                        }
                        
                        showDashboard();
                        setupUserInterface();
                        initializeSystem();
                        return;
                    }
                } catch (e) {
                    console.error('Erro ao restaurar sess√£o:', e);
                }
            }
            
            // Se n√£o houver sess√£o v√°lida, mostrar login
            showLogin();
        }

        // Mostrar tela de login
        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('dashboardScreen').style.display = 'none';
            
            // Limpar campos
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Mostrar dashboard
        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboardScreen').style.display = 'block';
            
            // Atualizar informa√ß√µes do usu√°rio
            if (currentUser) {
                document.getElementById('userWelcomeText').textContent = `Bem-vindo, ${currentUser.name}`;
                document.getElementById('userRoleBadge').textContent = getRoleDisplayName(currentUser.role);
                document.getElementById('userRoleBadge').className = `user-badge ${getRoleBadgeClass(currentUser.role)}`;
            }
        }

        // Configurar interface baseada no perfil
        function setupUserInterface() {
            if (!currentUser) return;
            
            const role = currentUser.role;
            
            // Esconder elementos baseado no perfil
            const cadastroTab = document.getElementById('cadastroTab');
            const databaseTab = document.getElementById('databaseTab');
            const backupCard = document.getElementById('backupCard');
            const storageInfo = document.getElementById('storageInfo');
            const syncButton = document.getElementById('syncFromOnlineBtn');
            const imageCaptureContainer = document.getElementById('imageCaptureContainer');
            const exportButtons = document.getElementById('exportExcelBtn').parentElement;
            
            // Configurar bot√£o de sincroniza√ß√£o para almoxarife
            if (syncButton) {
                if (role === 'almoxarife') {
                    syncButton.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Enviar para a Nuvem';
                }
            }
            
            switch(role) {
                case 'dev':
                    // Acesso total - mostrar tudo
                    cadastroTab.classList.remove('hidden');
                    databaseTab.classList.remove('hidden');
                    if (backupCard) backupCard.classList.remove('hidden');
                    if (storageInfo) storageInfo.classList.remove('hidden');
                    if (imageCaptureContainer) imageCaptureContainer.classList.remove('hidden');
                    break;
                    
                case 'almoxarife':
                    // Acesso: Dashboard, Cadastro, Cat√°logo, Exportar
                    cadastroTab.classList.remove('hidden');
                    databaseTab.classList.add('hidden');
                    if (backupCard) backupCard.classList.add('hidden');
                    if (storageInfo) storageInfo.classList.remove('hidden');
                    if (imageCaptureContainer) imageCaptureContainer.classList.remove('hidden');
                    break;
                    
                case 'user':
                    // Acesso: Dashboard, Cat√°logo, Exportar (apenas consulta)
                    cadastroTab.classList.add('hidden');
                    databaseTab.classList.add('hidden');
                    if (backupCard) backupCard.classList.add('hidden');
                    if (storageInfo) storageInfo.classList.add('hidden');
                    if (imageCaptureContainer) imageCaptureContainer.classList.add('hidden');
                    
                    // Desabilitar a√ß√µes nos formul√°rios
                    const formElements = document.querySelectorAll('#toolForm input, #toolForm select, #toolForm textarea');
                    formElements.forEach(el => el.disabled = true);
                    
                    // Esconder bot√µes de a√ß√£o no cat√°logo
                    const actionButtons = document.querySelectorAll('.action-btn-edit, .action-btn-delete');
                    actionButtons.forEach(btn => btn.style.display = 'none');
                    break;
            }
        }

        // Fun√ß√µes auxiliares para perfis
        function getRoleDisplayName(role) {
            switch(role) {
                case 'dev': return 'DEV';
                case 'almoxarife': return 'Almoxarife';
                case 'user': return 'Usu√°rio';
                default: return 'Usu√°rio';
            }
        }

        function getRoleBadgeClass(role) {
            switch(role) {
                case 'dev': return 'status-completed';
                case 'almoxarife': return 'status-ontrack';
                case 'user': return 'status-delayed';
                default: return '';
            }
        }

        // ============================================
        // FUN√á√ïES PRINCIPAIS DO SISTEMA (MANTIDAS)
        // ============================================

        // Inicializar sistema
        async function initializeSystem() {
            try {
                // Carregar dados locais
                await loadInitialTools();
                // Verificar status do IndexedDB
                await updateIndexedDBStatus();

                // Configurar Supabase se houver credenciais
                if (dbConfig.url && dbConfig.key) {
                    await setupSupabaseClient();
                }
                
                // Atualizar interface
                updateHeaderStats();
                updateStatistics();
                loadToolsList();
                
                // Configurar data atual no formul√°rio
                document.getElementById('dataCadastro').value = new Date().toISOString().split('T')[0];
                
                showNotification('Sistema inicializado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
                showNotification('Erro ao inicializar sistema.', 'error');
            }
        }

        // Verificar status do IndexedDB
        function checkIndexedDBStatus() {
            return new Promise((resolve) => {
                if (!window.indexedDB) {
                    resolve({ available: false, status: 'N√£o suportado' });
                    return;
                }

                const request = indexedDB.open('testConnection', 1);
                let dbConnected = false;

                request.onsuccess = () => {
                    dbConnected = true;
                    request.result.close();
                    resolve({ available: true, status: 'Conectado' });
                };

                request.onerror = () => {
                    resolve({ available: false, status: 'Erro' });
                };

                request.onblocked = () => {
                    resolve({ available: false, status: 'Bloqueado' });
                };

                // Timeout para detectar se est√° muito lento
                setTimeout(() => {
                    if (!dbConnected) {
                        resolve({ available: false, status: 'Timeout' });
                    }
                }, 1000);
            });
        }

        // Fun√ß√£o para atualizar o status do IndexedDB na interface
        async function updateIndexedDBStatus() {
            try {
                const status = await checkIndexedDBStatus();
                const statusElement = document.getElementById('indexedDBStatus');
                
                if (status.available && status.status === 'Conectado') {
                    statusElement.textContent = 'Conectado';
                    statusElement.className = 'status-badge status-completed';
                } else {
                    statusElement.textContent = 'Desconectado';
                    statusElement.className = 'status-badge status-delayed';
                }
                
                return status.available;
            } catch (error) {
                console.error('Erro ao verificar IndexedDB:', error);
                const statusElement = document.getElementById('indexedDBStatus');
                statusElement.textContent = 'Erro';
                statusElement.className = 'status-badge status-delayed';
                return false;
            }
        }

        // Carregar dados iniciais
        async function loadInitialTools() {
            try {
                const localData = localStorage.getItem('tools');
                if (localData) {
                    tools = JSON.parse(localData) || [];
                } else {
                    tools = getExampleTools();
                    await saveTools();
                }
                
                updateStorageInfo();
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                tools = getExampleTools();
            }
        }

        // Salvar dados localmente
        async function saveTools() {
            try {
                localStorage.setItem('tools', JSON.stringify(tools));
                updateStorageInfo();
                return true;
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                showNotification('Erro ao salvar dados localmente.', 'error');
                return false;
            }
        }

        // Configurar cliente Supabase
        async function setupSupabaseClient() {
            try {
                supabaseClient = supabase.createClient(dbConfig.url, dbConfig.key);
                isOnlineMode = true;
                
                // Testar conex√£o
                const connectionResult = await testSupabaseConnection();
                
                if (connectionResult.success) {
                    document.getElementById('storageStatus').textContent = 'Online';
                    document.getElementById('storageStatus').className = 'status-badge status-completed';
                    document.getElementById('dbStatusIndicator').className = 'status-indicator online';
                    document.getElementById('dbStatusText').textContent = 'Status: Conectado ao Banco Online';
                    
                    showNotification('Conectado ao banco de dados online!', 'success');
                    updateDatabaseInfo();
                    
                    return true;
                } else {
                    isOnlineMode = false;
                    showNotification(`Modo local: ${connectionResult.message}`, 'warning');
                    return false;
                }
                
            } catch (error) {
                console.error('Erro ao configurar Supabase:', error);
                isOnlineMode = false;
                return false;
            }
        }

        // Testar conex√£o com Supabase
        async function testSupabaseConnection() {
            try {
                const { data, error } = await supabaseClient
                    .from('tools')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    if (error.message.includes('does not exist')) {
                        return { success: false, message: 'Tabela n√£o existe.' };
                    }
                    throw error;
                }
                
                return { success: true, message: 'Conex√£o estabelecida!' };
            } catch (error) {
                return { success: false, message: `Erro: ${error.message}` };
            }
        }

        // Criar tabela no Supabase
        async function createTableInSupabase() {
            try {
                const resultElement = document.getElementById('tableCreationResult');
                resultElement.innerHTML = '<p style="color: blue;">Criando tabela...</p>';
                
                // Tentar criar tabela com insert
                const testData = {
                    name: 'Item de Teste',
                    code: 'TEST-' + Date.now(),
                    ncm: '9999.99.99',
                    category: 'Teste',
                    status: 'Dispon√≠vel',
                    location: 'Teste',
                    condition: 'Novo'
                };
                
                const { error } = await supabaseClient
                    .from('tools')
                    .insert([testData]);
                
                if (error && error.message.includes('does not exist')) {
                    resultElement.innerHTML = `
                        <p style="color: red;">‚ùå Tabela n√£o existe.</p>
                        <p>Execute este SQL no Supabase (SQL Editor):</p>
                        <div class="code-block">
-- TABELA COMPLETA PARA SISTEMA DE FERRAMENTAS
CREATE TABLE IF NOT EXISTS tools (
    id BIGSERIAL PRIMARY KEY,
    name TEXT NOT NULL,
    code TEXT NOT NULL UNIQUE,
    patrimonio TEXT,
    ncm TEXT NOT NULL,
    category TEXT NOT NULL,
    status TEXT NOT NULL,
    location TEXT NOT NULL,
    condition TEXT NOT NULL,
    nota_fiscal TEXT,
    unidade TEXT,
    preco NUMERIC(10,2),
    quantidade INTEGER DEFAULT 1,
    estoque_minimo INTEGER DEFAULT 0,
    estoque_maximo INTEGER DEFAULT 0,
    description TEXT,
    observations TEXT,
    image_url TEXT,
    data_cadastro DATE DEFAULT CURRENT_DATE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
                        </div>
                    `;
                    return false;
                } else {
                    // Excluir item de teste
                    await supabaseClient
                        .from('tools')
                        .delete()
                        .eq('code', testData.code);
                    
                    resultElement.innerHTML = '<p style="color: green;">‚úÖ Tabela verificada/criada com sucesso!</p>';
                    showNotification('Tabela verificada com sucesso!', 'success');
                    updateDatabaseInfo();
                    return true;
                }
            } catch (error) {
                console.error('Erro ao criar tabela:', error);
                const resultElement = document.getElementById('tableCreationResult');
                resultElement.innerHTML = `<p style="color: red;">‚ùå Erro: ${error.message}</p>`;
                return false;
            }
        }

        // ============================================
        // FUN√á√ïES DE INTERFACE (MANTIDAS)
        // ============================================

        // Atualizar cabe√ßalho
        function updateHeaderStats() {
            document.getElementById('totalTools').textContent = tools.length;
            
            // Calcular valor total
            const totalValue = tools.reduce((sum, tool) => {
                const preco = parseFloat(tool.preco) || 0;
                const quantidade = parseInt(tool.quantidade) || 1;
                return sum + (preco * quantidade);
            }, 0);
            
            document.getElementById('totalValue').textContent = formatCurrency(totalValue);
            document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('pt-BR');
        }

        // Atualizar informa√ß√µes de armazenamento
        function updateStorageInfo() {
            const storageInfoText = document.getElementById('storageInfoText');
            if (storageInfoText) {
                const dataSize = JSON.stringify(tools).length;
                const sizeKB = Math.round(dataSize / 1024);
                storageInfoText.textContent = `Itens: ${tools.length} | Tamanho: ${sizeKB} KB`;
            }
        }

        // Atualizar estat√≠sticas
        function updateStatistics() {
            const total = tools.length;
            
            if (total === 0) {
                resetStats();
                return;
            }
            
            const availableCount = tools.filter(tool => tool.status === 'Dispon√≠vel').length;
            const inUseCount = tools.filter(tool => tool.status === 'Em Uso').length;
            const maintenanceCount = tools.filter(tool => tool.status === 'Manuten√ß√£o').length;
            const damagedCount = tools.filter(tool => tool.status === 'Danificado').length;
            
            updateProgressBars(total, availableCount, inUseCount, maintenanceCount, damagedCount);
            updateValueStats();
            updateLowStockItems();
            updateLocationChart();
        }

        function resetStats() {
            document.getElementById('availablePercent').textContent = '0%';
            document.getElementById('inUsePercent').textContent = '0%';
            document.getElementById('maintenancePercent').textContent = '0%';
            document.getElementById('damagedPercent').textContent = '0%';
            
            document.getElementById('availableBar').style.width = '0%';
            document.getElementById('inUseBar').style.width = '0%';
            document.getElementById('maintenanceBar').style.width = '0%';
            document.getElementById('damagedBar').style.width = '0%';
            
            document.getElementById('valueStats').innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 20px 0;">Nenhum item cadastrado</p>';
            document.getElementById('lowStockItems').innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 20px 0;">Nenhum item cadastrado</p>';
            
            if (chartInstance) {
                chartInstance.destroy();
            }
        }

        function updateProgressBars(total, available, inUse, maintenance, damaged) {
            const availablePercent = Math.round((available / total) * 100);
            const inUsePercent = Math.round((inUse / total) * 100);
            const maintenancePercent = Math.round((maintenance / total) * 100);
            const damagedPercent = Math.round((damaged / total) * 100);
            
            document.getElementById('availablePercent').textContent = `${availablePercent}%`;
            document.getElementById('inUsePercent').textContent = `${inUsePercent}%`;
            document.getElementById('maintenancePercent').textContent = `${maintenancePercent}%`;
            document.getElementById('damagedPercent').textContent = `${damagedPercent}%`;
            
            document.getElementById('availableBar').style.width = `${availablePercent}%`;
            document.getElementById('inUseBar').style.width = `${inUsePercent}%`;
            document.getElementById('maintenanceBar').style.width = `${maintenancePercent}%`;
            document.getElementById('damagedBar').style.width = `${damagedPercent}%`;
        }

        function updateValueStats() {
            const categoryValue = {};
            tools.forEach(tool => {
                const preco = parseFloat(tool.preco) || 0;
                const quantidade = parseInt(tool.quantidade) || 1;
                const valor = preco * quantidade;
                
                if (!categoryValue[tool.category]) {
                    categoryValue[tool.category] = 0;
                }
                categoryValue[tool.category] += valor;
            });
            
            const totalValue = Object.values(categoryValue).reduce((a, b) => a + b, 0);
            let valueHTML = '';
            
            for (const [category, value] of Object.entries(categoryValue)) {
                const percent = totalValue > 0 ? Math.round((value / totalValue) * 100) : 0;
                valueHTML += `
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>${category}</span>
                            <span>${formatCurrency(value)}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percent}%; background-color: ${getRandomColor()}"></div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('valueStats').innerHTML = valueHTML || '<p style="text-align: center; color: var(--gray-color); padding: 20px 0;">Nenhum valor cadastrado</p>';
        }

        function updateLowStockItems() {
            const lowStockItems = tools.filter(tool => {
                const quantidade = parseInt(tool.quantidade) || 0;
                const estoqueMinimo = parseInt(tool.estoqueMinimo) || 0;
                return estoqueMinimo > 0 && quantidade <= estoqueMinimo;
            }).slice(0, 5);
            
            if (lowStockItems.length > 0) {
                let lowStockHTML = '';
                lowStockItems.forEach(item => {
                    lowStockHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.1);">
                            <div>
                                <p style="font-weight: 500; margin-bottom: 2px;">${item.name}</p>
                                <p style="font-size: 12px; color: var(--gray-color);">${item.code} | Estoque: ${item.quantidade} | M√≠nimo: ${item.estoqueMinimo}</p>
                            </div>
                            <span class="status-badge status-delayed">Baixo</span>
                        </div>
                    `;
                });
                document.getElementById('lowStockItems').innerHTML = lowStockHTML;
            } else {
                document.getElementById('lowStockItems').innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 20px 0;">Nenhum item com estoque baixo</p>';
            }
        }

        function updateLocationChart() {
            const ctx = document.getElementById('locationChart').getContext('2d');
            
            const locations = {};
            tools.forEach(tool => {
                locations[tool.location] = (locations[tool.location] || 0) + 1;
            });
            
            const locationLabels = Object.keys(locations);
            const locationData = Object.values(locations);
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            if (locationLabels.length > 0) {
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: locationLabels,
                        datasets: [{
                            label: 'Itens',
                            data: locationData,
                            backgroundColor: locationLabels.map(() => getRandomColor()),
                            borderColor: 'rgba(255, 255, 255, 0.8)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw} itens`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, ticks: { stepSize: 1 } }
                        }
                    }
                });
            }
        }

        // ============================================
        // FUN√á√ïES DE FORMUL√ÅRIO (MANTIDAS)
        // ============================================

        // Validar formul√°rio
        function validateForm() {
            let isValid = true;
            
            const toolName = document.getElementById('toolName').value.trim();
            const toolCode = document.getElementById('toolCode').value.trim();
            const ncmCode = document.getElementById('ncmCode').value.trim();
            const toolCategory = document.getElementById('toolCategory').value;
            const toolStatus = document.getElementById('toolStatus').value;
            const toolLocation = document.getElementById('toolLocation').value;
            const toolCondition = document.getElementById('toolCondition').value;
            
            // Limpar erros
            document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
            
            // Validar campos obrigat√≥rios
            if (!toolName) {
                document.getElementById('toolName').classList.add('error');
                document.getElementById('toolNameError').style.display = 'block';
                isValid = false;
            }
            
            if (!toolCode) {
                document.getElementById('toolCode').classList.add('error');
                document.getElementById('toolCodeError').textContent = 'O c√≥digo √© obrigat√≥rio';
                document.getElementById('toolCodeError').style.display = 'block';
                isValid = false;
            } else if (isEditing) {
                if (tools.some(tool => tool.code === toolCode && tool.id !== editingToolId)) {
                    document.getElementById('toolCode').classList.add('error');
                    document.getElementById('toolCodeError').textContent = 'J√° existe um item com este c√≥digo';
                    document.getElementById('toolCodeError').style.display = 'block';
                    isValid = false;
                }
            } else {
                if (tools.some(tool => tool.code === toolCode)) {
                    document.getElementById('toolCode').classList.add('error');
                    document.getElementById('toolCodeError').textContent = 'J√° existe um item com este c√≥digo';
                    document.getElementById('toolCodeError').style.display = 'block';
                    isValid = false;
                }
            }
            
            if (!toolCategory) {
                document.getElementById('toolCategory').classList.add('error');
                document.getElementById('toolCategoryError').style.display = 'block';
                isValid = false;
            }
            
            if (!toolStatus) {
                document.getElementById('toolStatus').classList.add('error');
                document.getElementById('toolStatusError').style.display = 'block';
                isValid = false;
            }
            
            if (!toolLocation) {
                document.getElementById('toolLocation').classList.add('error');
                document.getElementById('toolLocationError').style.display = 'block';
                isValid = false;
            }
            
            if (!toolCondition) {
                document.getElementById('toolCondition').classList.add('error');
                document.getElementById('toolConditionError').style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }

        // Salvar item
        async function saveTool() {
            if (!validateForm()) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return false;
            }
            
            // Verificar permiss√£o
            if (currentUser.role === 'user') {
                showNotification('Usu√°rio n√£o tem permiss√£o para salvar itens.', 'error');
                return false;
            }
            
            try {
                const toolData = getFormData();
                
                if (isEditing && editingToolId) {
                    await updateTool(editingToolId, toolData);
                } else {
                    await createTool(toolData);
                }
                
                return true;
            } catch (error) {
                console.error('Erro ao salvar item:', error);
                showNotification('Erro ao salvar item.', 'error');
                return false;
            }
        }

        function getFormData() {
            return {
                name: document.getElementById('toolName').value.trim(),
                code: document.getElementById('toolCode').value.trim(),
                patrimonio: document.getElementById('patrimonioNumber').value.trim(),
                ncm: document.getElementById('ncmCode').value.trim(),
                category: document.getElementById('toolCategory').value,
                status: document.getElementById('toolStatus').value,
                location: document.getElementById('toolLocation').value,
                condition: document.getElementById('toolCondition').value,
                notaFiscal: document.getElementById('notaFiscal').value.trim(),
                unidade: document.getElementById('unidadeMedida').value,
                preco: parseFloat(document.getElementById('preco').value) || 0,
                quantidade: parseInt(document.getElementById('quantidadeAtual').value) || 1,
                estoqueMinimo: parseInt(document.getElementById('estoqueMinimo').value) || 0,
                estoqueMaximo: parseInt(document.getElementById('estoqueMaximo').value) || 0,
                dataCadastro: document.getElementById('dataCadastro').value,
                description: document.getElementById('toolDescription').value.trim(),
                observations: document.getElementById('toolObservations').value.trim(),
                image: currentToolImage
            };
        }

        async function createTool(toolData) {
            const newTool = {
                id: Date.now(),
                ...toolData,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            tools.push(newTool);
            
            await saveTools();
            
            if (isOnlineMode && supabaseClient) {
                await saveToolToSupabase(newTool);
            }
            
            updateInterface();
            showNotification('Item cadastrado com sucesso!', 'success');
            clearForm();
        }

        async function updateTool(toolId, toolData) {
            const toolIndex = tools.findIndex(t => t.id === toolId);
            
            if (toolIndex === -1) {
                showNotification('Item n√£o encontrado!', 'error');
                return false;
            }
            
            const updatedTool = {
                ...tools[toolIndex],
                ...toolData,
                updatedAt: new Date().toISOString()
            };
            
            tools[toolIndex] = updatedTool;
            
            await saveTools();
            
            if (isOnlineMode && supabaseClient) {
                await saveToolToSupabase(updatedTool);
            }
            
            updateInterface();
            showNotification('Item atualizado com sucesso!', 'success');
            clearForm();
            
            return true;
        }

        // Converter para formato Supabase
        function convertToSupabaseFormat(tool) {
            return {
                name: tool.name,
                code: tool.code,
                patrimonio: tool.patrimonio || null,
                ncm: tool.ncm,
                category: tool.category,
                status: tool.status,
                location: tool.location,
                condition: tool.condition,
                nota_fiscal: tool.notaFiscal || null,
                unidade: tool.unidade || 'UN',
                preco: tool.preco || 0,
                quantidade: tool.quantidade || 1,
                estoque_minimo: tool.estoqueMinimo || 0,
                estoque_maximo: tool.estoqueMaximo || 0,
                description: tool.description || null,
                observations: tool.observations || null,
                image_url: tool.image || null,
                data_cadastro: tool.dataCadastro || new Date().toISOString().split('T')[0],
                updated_at: new Date().toISOString()
            };
        }

        // Salvar no Supabase
        async function saveToolToSupabase(tool) {
            try {
                const toolData = convertToSupabaseFormat(tool);
                
                // Verificar se j√° existe
                const { data: existing } = await supabaseClient
                    .from('tools')
                    .select('id')
                    .eq('code', tool.code)
                    .maybeSingle();
                
                if (existing) {
                    // Atualizar
                    const { error } = await supabaseClient
                        .from('tools')
                        .update(toolData)
                        .eq('code', tool.code);
                    
                    if (error) throw error;
                } else {
                    // Inserir
                    toolData.created_at = tool.createdAt || new Date().toISOString();
                    
                    const { error } = await supabaseClient
                        .from('tools')
                        .insert([toolData]);
                    
                    if (error) throw error;
                }
                
                return true;
            } catch (error) {
                console.error('Erro ao salvar no Supabase:', error);
                showNotification('Erro ao salvar na nuvem.', 'warning');
                return false;
            }
        }

        // ============================================
        // FUN√á√ïES DE LISTAGEM (MANTIDAS)
        // ============================================

        // Carregar lista de itens
        function loadToolsList(filter = 'all') {
            const tbody = document.getElementById('toolsTableBody');
            const noToolsRow = document.getElementById('noToolsRow');
            
            tbody.innerHTML = '';
            tbody.appendChild(noToolsRow);
            
            let filteredTools = tools;
            
            if (filter === 'available') {
                filteredTools = tools.filter(tool => tool.status === 'Dispon√≠vel');
            } else if (filter === 'inuse') {
                filteredTools = tools.filter(tool => tool.status === 'Em Uso');
            } else if (filter === 'maintenance') {
                filteredTools = tools.filter(tool => tool.status === 'Manuten√ß√£o');
            } else if (filter === 'lowstock') {
                filteredTools = tools.filter(tool => {
                    const quantidade = parseInt(tool.quantidade) || 0;
                    const estoqueMinimo = parseInt(tool.estoqueMinimo) || 0;
                    return estoqueMinimo > 0 && quantidade <= estoqueMinimo;
                });
            }
            
            const searchTerm = document.getElementById('searchTool')?.value.toLowerCase();
            if (searchTerm) {
                filteredTools = filteredTools.filter(tool => 
                    tool.name.toLowerCase().includes(searchTerm) ||
                    tool.code.toLowerCase().includes(searchTerm) ||
                    (tool.patrimonio && tool.patrimonio.toLowerCase().includes(searchTerm)) ||
                    tool.category.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredTools.length === 0) {
                noToolsRow.style.display = 'table-row';
                noToolsRow.innerHTML = `<td colspan="13" style="text-align: center; padding: 40px; color: var(--gray-color);">
                    Nenhum item encontrado${searchTerm ? ' para "' + searchTerm + '"' : ''}
                </td>`;
                return;
            }
            
            noToolsRow.style.display = 'none';
            
            filteredTools.forEach(tool => {
                const row = document.createElement('tr');
                row.innerHTML = createTableRow(tool);
                tbody.appendChild(row);
            });
            
            addRowEventListeners();
        }

        function createTableRow(tool) {
            const statusClass = getStatusClass(tool.status);
            const stockInfo = getStockInfo(tool);
            
            // Verificar permiss√µes para a√ß√µes
            const canEdit = currentUser.role !== 'user';
            
            return `
                <td style="text-align: center;">
                    <button class="action-btn action-btn-view" data-id="${tool.id}" title="Gerar QR Code" style="font-size: 20px;">
                        <i class="fas fa-qrcode"></i>
                    </button>
                </td>
                <td><strong>${tool.code}</strong></td>
                <td>${tool.name}</td>
                <td>${tool.patrimonio || '-'}</td>
                <td>${tool.category}</td>
                <td><span class="status-badge ${statusClass}">${tool.status}</span></td>
                <td>${tool.location}</td>
                <td>${tool.condition}</td>
                <td>${tool.unidade || 'UN'}</td>
                <td class="${stockInfo.class}">${stockInfo.text}</td>
                <td>${tool.preco ? formatCurrency(tool.preco) : '-'}</td>
                <td>${formatDate(tool.dataCadastro)}</td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn action-btn-view" data-id="${tool.id}" title="Visualizar">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${canEdit ? `
                            <button class="action-btn action-btn-edit" data-id="${tool.id}" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn action-btn-delete" data-id="${tool.id}" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </div>
                </td>
            `;
        }

        function getStatusClass(status) {
            switch(status) {
                case 'Dispon√≠vel': return 'status-completed';
                case 'Em Uso': return 'status-ontrack';
                case 'Manuten√ß√£o': return 'status-delayed';
                case 'Danificado': return 'status-delayed';
                default: return 'status-ontrack';
            }
        }

        function getStockInfo(tool) {
            const quantidade = parseInt(tool.quantidade) || 0;
            const estoqueMinimo = parseInt(tool.estoqueMinimo) || 0;
            
            if (estoqueMinimo > 0 && quantidade <= estoqueMinimo) {
                return { class: 'stock-low', text: `${quantidade} ‚ö†Ô∏è` };
            } else if (tool.estoqueMaximo && quantidade >= tool.estoqueMaximo) {
                return { class: 'stock-high', text: quantidade };
            } else {
                return { class: 'stock-normal', text: quantidade };
            }
        }

        function addRowEventListeners() {
            document.querySelectorAll('.action-btn-view').forEach(btn => {
                if (btn.title === 'Gerar QR Code') {
                    btn.addEventListener('click', function() {
                        const toolId = parseInt(this.getAttribute('data-id'));
                        generateQRCodeForTool(toolId);
                    });
                } else {
                    btn.addEventListener('click', function() {
                        const toolId = parseInt(this.getAttribute('data-id'));
                        viewToolDetails(toolId);
                    });
                }
            });
            
            document.querySelectorAll('.action-btn-edit').forEach(btn => {
                btn.addEventListener('click', function() {
                    const toolId = parseInt(this.getAttribute('data-id'));
                    editTool(toolId);
                });
            });
            
            document.querySelectorAll('.action-btn-delete').forEach(btn => {
                btn.addEventListener('click', function() {
                    const toolId = parseInt(this.getAttribute('data-id'));
                    deleteTool(toolId);
                });
            });
        }

        // ============================================
        // FUN√á√ïES AUXILIARES (MANTIDAS)
        // ============================================

        // Dados de exemplo
        function getExampleTools() {
            return [
                {
                    id: 1,
                    name: "Martelo de Borracha 500g",
                    code: "MART-001",
                    patrimonio: "PAT-2023-001",
                    ncm: "8205.70.00",
                    category: "Ferramentas Manuais",
                    status: "Dispon√≠vel",
                    location: "Almoxarifado Central",
                    condition: "Bom",
                    notaFiscal: "NF-2023-001234",
                    unidade: "UN",
                    preco: 25.90,
                    quantidade: 5,
                    estoqueMinimo: 2,
                    estoqueMaximo: 10,
                    dataCadastro: "2023-10-15",
                    description: "Martelo de borracha para servi√ßos de acabamento",
                    observations: "Usar apenas para superf√≠cies delicadas",
                    image: "",
                    createdAt: "2023-10-15T09:30:00Z",
                    updatedAt: "2023-10-15T09:30:00Z"
                },
                {
                    id: 2,
                    name: "Furadeira de Impacto 750W",
                    code: "FUR-012",
                    patrimonio: "PAT-2023-002",
                    ncm: "8467.21.00",
                    category: "Ferramentas El√©tricas",
                    status: "Em Uso",
                    location: "Oficina Mec√¢nica",
                    condition: "Regular",
                    notaFiscal: "NF-2023-001235",
                    unidade: "UN",
                    preco: 450.00,
                    quantidade: 1,
                    estoqueMinimo: 0,
                    estoqueMaximo: 2,
                    dataCadastro: "2023-10-10",
                    description: "Furadeira de impacto 750W com maleta e acess√≥rios",
                    observations: "Necessita revis√£o das escovas",
                    image: "",
                    createdAt: "2023-10-10T14:20:00Z",
                    updatedAt: "2023-10-20T11:15:00Z"
                },
                {
                    id: 3,
                    name: "Capacete de Seguran√ßa",
                    code: "EPI-005",
                    patrimonio: "PAT-2023-003",
                    ncm: "6506.10.00",
                    category: "EPI",
                    status: "Dispon√≠vel",
                    location: "Almoxarifado Central",
                    condition: "Novo",
                    notaFiscal: "NF-2023-001236",
                    unidade: "UN",
                    preco: 35.50,
                    quantidade: 12,
                    estoqueMinimo: 5,
                    estoqueMaximo: 20,
                    dataCadastro: "2023-09-28",
                    description: "Capacete de seguran√ßa com jugular, cor amarela",
                    observations: "Lote 2023/09",
                    image: "",
                    createdAt: "2023-09-28T16:45:00Z",
                    updatedAt: "2023-10-18T10:30:00Z"
                }
            ];
        }

        // Formatar data
        function formatDate(dateString) {
            if (!dateString) return '-';
            try {
                return new Date(dateString).toLocaleDateString('pt-BR');
            } catch (e) {
                return dateString;
            }
        }

        // Formatar moeda
        function formatCurrency(value) {
            if (!value && value !== 0) return 'R$ 0,00';
            return `R$ ${parseFloat(value).toFixed(2).replace('.', ',')}`;
        }

        // Gerar cor aleat√≥ria
        function getRandomColor() {
            const colors = [
                '#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6',
                '#1abc9c', '#d35400', '#c0392b', '#16a085', '#8e44ad'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Mostrar notifica√ß√£o
        function showNotification(message, type) {
            const existing = document.querySelectorAll('.notification');
            existing.forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // Limpar formul√°rio
        function clearForm() {
            document.getElementById('toolForm').reset();
            document.getElementById('dataCadastro').value = new Date().toISOString().split('T')[0];
            document.getElementById('cameraPlaceholder').style.display = 'block';
            document.getElementById('toolImagePreview').style.display = 'none';
            document.getElementById('toolImagePreview').src = '';
            currentToolImage = null;
            
            document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
            
            isEditing = false;
            editingToolId = null;
            
            const saveBtn = document.getElementById('saveToolBtn');
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Item';
        }

        // Atualizar interface completa
        function updateInterface() {
            updateHeaderStats();
            updateStatistics();
            loadToolsList();
            updateStorageInfo();
        }

        // ============================================
        // FUN√á√ïES DE SINCRONIZA√á√ÉO (MANTIDAS)
        // ============================================

        // Buscar dados do Supabase
        async function fetchFromSupabase() {
            try {
                const limit = parseInt(document.getElementById('syncLimit').value) || 100;
                
                const { data, error } = await supabaseClient
                    .from('tools')
                    .select('*')
                    .order('updated_at', { ascending: false })
                    .limit(limit);
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    const convertedTools = data.map(item => ({
                        id: item.id || Date.now(),
                        name: item.name,
                        code: item.code,
                        patrimonio: item.patrimonio,
                        ncm: item.ncm,
                        category: item.category,
                        status: item.status,
                        location: item.location,
                        condition: item.condition,
                        notaFiscal: item.nota_fiscal,
                        unidade: item.unidade,
                        preco: item.preco,
                        quantidade: item.quantidade,
                        estoqueMinimo: item.estoque_minimo,
                        estoqueMaximo: item.estoque_maximo,
                        description: item.description,
                        observations: item.observations,
                        image: item.image_url,
                        dataCadastro: item.data_cadastro,
                        createdAt: item.created_at,
                        updatedAt: item.updated_at
                    }));
                    
                    tools = convertedTools;
                    await saveTools();
                    updateInterface();
                    
                    showNotification(`${convertedTools.length} itens carregados da nuvem!`, 'success');
                    return true;
                } else {
                    showNotification('Nenhum dado encontrado na nuvem.', 'info');
                    return false;
                }
            } catch (error) {
                console.error('Erro ao buscar do Supabase:', error);
                showNotification(`Erro ao buscar dados: ${error.message}`, 'error');
                return false;
            }
        }

        // Enviar dados para Supabase
        async function syncToSupabase() {
            try {
                let successCount = 0;
                let errorCount = 0;
                
                for (const tool of tools) {
                    try {
                        const result = await saveToolToSupabase(tool);
                        if (result) successCount++;
                        else errorCount++;
                    } catch (error) {
                        errorCount++;
                        console.error(`Erro ao sincronizar ${tool.code}:`, error);
                    }
                }
                
                if (errorCount === 0) {
                    showNotification(`${successCount} itens sincronizados com sucesso!`, 'success');
                } else {
                    showNotification(`${successCount} sucessos, ${errorCount} erros na sincroniza√ß√£o.`, 'warning');
                }
                
                return true;
            } catch (error) {
                console.error('Erro na sincroniza√ß√£o:', error);
                showNotification('Erro na sincroniza√ß√£o.', 'error');
                return false;
            }
        }

        // Atualizar informa√ß√µes do banco
        async function updateDatabaseInfo() {
            if (!supabaseClient) return;
            
            try {
                const { count } = await supabaseClient
                    .from('tools')
                    .select('*', { count: 'exact', head: true });
                
                const dbInfoElement = document.getElementById('dbInfo');
                if (dbInfoElement) {
                    dbInfoElement.innerHTML = `
                        <div style="padding: 20px;">
                            <h4 style="margin-bottom: 15px;">Informa√ß√µes do Banco de Dados</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div class="info-item">
                                    <div class="info-label">Status</div>
                                    <div class="info-value"><span class="status-badge status-completed">Conectado</span></div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Itens Online</div>
                                    <div class="info-value">${count || 0}</div>
                                </div>
                            </div>
                            <p style="text-align: center; color: var(--gray-color);">
                                Dados locais: ${tools.length} itens
                            </p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Erro ao atualizar info do banco:', error);
            }
        }

        // ============================================
        // FUN√á√ïES DE VISUALIZA√á√ÉO E EDI√á√ÉO (MANTIDAS)
        // ============================================

        // Visualizar detalhes
        function viewToolDetails(toolId) {
            const tool = tools.find(t => t.id === toolId);
            if (!tool) return;
            
            const modalBody = document.getElementById('toolModalBody');
            modalBody.innerHTML = createToolDetailsHTML(tool);
            
            document.getElementById('toolModal').style.display = 'flex';
        }

        function createToolDetailsHTML(tool) {
            return `
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
                    <div>
                        ${tool.image ? 
                            `<img src="${tool.image}" alt="${tool.name}" style="width: 100%; border-radius: 8px;">` :
                            '<div style="background-color: #f5f5f5; height: 200px; display: flex; align-items: center; justify-content: center; border-radius: 8px;"><i class="fas fa-box" style="font-size: 60px; color: #ccc;"></i></div>'
                        }
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn btn-primary" onclick="generateQRCodeForTool(${tool.id})">
                                <i class="fas fa-qrcode"></i> Gerar QR Code
                            </button>
                        </div>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 10px; color: var(--primary-color);">${tool.name}</h3>
                        <p style="color: var(--gray-color); margin-bottom: 20px;">C√≥digo: ${tool.code} | Patrim√¥nio: ${tool.patrimonio || 'N√£o informado'}</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div><strong>N.C.M.:</strong> ${tool.ncm || '-'}</div>
                            <div><strong>Categoria:</strong> ${tool.category}</div>
                            <div><strong>Status:</strong> <span class="status-badge ${getStatusClass(tool.status)}">${tool.status}</span></div>
                            <div><strong>Localiza√ß√£o:</strong> ${tool.location}</div>
                            <div><strong>Condi√ß√£o:</strong> ${tool.condition}</div>
                            <div><strong>Unidade:</strong> ${tool.unidade || 'UN'}</div>
                            <div><strong>Nota Fiscal:</strong> ${tool.notaFiscal || '-'}</div>
                            <div><strong>Pre√ßo:</strong> ${formatCurrency(tool.preco)}</div>
                            <div><strong>Quantidade:</strong> ${tool.quantidade || 1}</div>
                            <div><strong>Estoque M√≠n:</strong> ${tool.estoqueMinimo || 0}</div>
                            <div><strong>Estoque M√°x:</strong> ${tool.estoqueMaximo || 0}</div>
                            <div><strong>Data Cadastro:</strong> ${formatDate(tool.dataCadastro)}</div>
                        </div>
                        
                        ${tool.description ? `
                            <div style="margin-bottom: 15px;">
                                <strong>Descri√ß√£o:</strong>
                                <p>${tool.description}</p>
                            </div>
                        ` : ''}
                        
                        ${tool.observations ? `
                            <div style="margin-bottom: 15px;">
                                <strong>Observa√ß√µes:</strong>
                                <p>${tool.observations}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Editar item
        function editTool(toolId) {
            // Verificar permiss√£o
            if (currentUser.role === 'user') {
                showNotification('Usu√°rio n√£o tem permiss√£o para editar itens.', 'error');
                return;
            }
            
            // Mudar para aba de cadastro
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector('[data-tab="cadastro"]').classList.add('active');
            document.getElementById('cadastro').classList.add('active');
            
            const tool = tools.find(t => t.id === toolId);
            if (!tool) return;
            
            // Preencher formul√°rio
            document.getElementById('toolName').value = tool.name;
            document.getElementById('toolCode').value = tool.code;
            document.getElementById('patrimonioNumber').value = tool.patrimonio || '';
            document.getElementById('ncmCode').value = tool.ncm || '';
            document.getElementById('toolCategory').value = tool.category;
            document.getElementById('toolStatus').value = tool.status;
            document.getElementById('toolLocation').value = tool.location;
            document.getElementById('toolCondition').value = tool.condition;
            document.getElementById('notaFiscal').value = tool.notaFiscal || '';
            document.getElementById('unidadeMedida').value = tool.unidade || 'UN';
            document.getElementById('preco').value = tool.preco || '';
            document.getElementById('quantidadeAtual').value = tool.quantidade || 1;
            document.getElementById('estoqueMinimo').value = tool.estoqueMinimo || 0;
            document.getElementById('estoqueMaximo').value = tool.estoqueMaximo || 0;
            document.getElementById('dataCadastro').value = tool.dataCadastro || '';
            document.getElementById('toolDescription').value = tool.description || '';
            document.getElementById('toolObservations').value = tool.observations || '';
            
            if (tool.image) {
                currentToolImage = tool.image;
                document.getElementById('cameraPlaceholder').style.display = 'none';
                document.getElementById('toolImagePreview').style.display = 'block';
                document.getElementById('toolImagePreview').src = tool.image;
            }
            
            isEditing = true;
            editingToolId = toolId;
            
            document.getElementById('saveToolBtn').innerHTML = '<i class="fas fa-save"></i> Atualizar Item';
            
            showNotification('Editando item. Atualize os dados.', 'warning');
        }

        // Excluir item
        async function deleteTool(toolId) {
            // Verificar permiss√£o
            if (currentUser.role === 'user') {
                showNotification('Usu√°rio n√£o tem permiss√£o para excluir itens.', 'error');
                return;
            }
            
            if (!confirm('Tem certeza que deseja excluir este item?')) {
                return;
            }
            
            const tool = tools.find(t => t.id === toolId);
            if (!tool) {
                showNotification('Item n√£o encontrado!', 'error');
                return;
            }
            
            // Remover localmente
            tools = tools.filter(t => t.id !== toolId);
            await saveTools();
            
            // Remover do Supabase
            if (isOnlineMode && supabaseClient) {
                try {
                    await supabaseClient
                        .from('tools')
                        .delete()
                        .eq('code', tool.code);
                } catch (error) {
                    console.error('Erro ao excluir do Supabase:', error);
                }
            }
            
            updateInterface();
            showNotification('Item exclu√≠do com sucesso!', 'success');
        }

        // Gerar QR Code
        window.generateQRCodeForTool = function(toolId) {
            const tool = tools.find(t => t.id === toolId);
            if (!tool) return;
            
            const qrContent = JSON.stringify({
                nome: tool.name,
                codigo: tool.code,
                patrimonio: tool.patrimonio,
                ncm: tool.ncm,
                categoria: tool.category,
                status: tool.status,
                localizacao: tool.location,
                condicao: tool.condition,
                data_cadastro: tool.dataCadastro
            }, null, 2);
            
            const qrModalBody = document.getElementById('qrModalBody');
            qrModalBody.innerHTML = `
                <div class="qrcode-container">
                    <h4 style="margin-bottom: 20px;">QR Code para: ${tool.name}</h4>
                    <div id="qrcodeCanvas" style="margin: 0 auto 20px;"></div>
                    <p style="margin-top: 20px; color: var(--gray-color); font-size: 14px;">
                        Use este QR Code para identificar rapidamente o item.
                    </p>
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="downloadQRCodeBtn">
                            <i class="fas fa-download"></i> Baixar QR Code
                        </button>
                        <button class="btn btn-success" id="printQRCodeBtn">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                    </div>
                </div>
            `;
            
            // Gerar QR Code
            QRCode.toCanvas(document.getElementById('qrcodeCanvas'), qrContent, {
                width: 200,
                margin: 2,
                color: { dark: '#000000', light: '#FFFFFF' }
            });
            
            // Configurar bot√µes
            document.getElementById('downloadQRCodeBtn').onclick = function() {
                const canvas = document.querySelector('#qrcodeCanvas canvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = `QRCode_${tool.code}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }
            };
            
            document.getElementById('printQRCodeBtn').onclick = function() {
                window.print();
            };
            
            document.getElementById('qrModal').style.display = 'flex';
        };

        // ============================================
        // FUN√á√ïES DE BACKUP E EXPORTA√á√ÉO (MANTIDAS)
        // ============================================

        // Fazer backup
        async function createBackup() {
            // Verificar permiss√£o
            if (currentUser.role === 'user') {
                showNotification('Usu√°rio n√£o tem permiss√£o para fazer backup.', 'error');
                return;
            }
            
            try {
                const backupData = {
                    tools: tools,
                    timestamp: new Date().toISOString(),
                    count: tools.length
                };
                
                const blob = new Blob([JSON.stringify(backupData, null, 2)], { 
                    type: 'application/json' 
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_ferramentas_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification(`Backup criado com ${tools.length} itens!`, 'success');
                
            } catch (error) {
                console.error('Erro ao criar backup:', error);
                showNotification('Erro ao criar backup.', 'error');
            }
        }

        // Restaurar backup
        function handleRestoreBackup(file) {
            // Verificar permiss√£o
            if (currentUser.role === 'user') {
                showNotification('Usu√°rio n√£o tem permiss√£o para restaurar backup.', 'error');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(event) {
                try {
                    const backupData = JSON.parse(event.target.result);
                    
                    if (!backupData.tools || !Array.isArray(backupData.tools)) {
                        showNotification('Arquivo de backup inv√°lido.', 'error');
                        return;
                    }
                    
                    if (!confirm(`Restaurar backup com ${backupData.tools.length} itens? Os dados atuais ser√£o substitu√≠dos.`)) {
                        return;
                    }
                    
                    tools = backupData.tools;
                    await saveTools();
                    updateInterface();
                    
                    showNotification(`${backupData.tools.length} itens restaurados!`, 'success');
                    
                } catch (error) {
                    console.error('Erro ao restaurar backup:', error);
                    showNotification('Erro ao restaurar backup.', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Erro ao ler arquivo.', 'error');
            };
            
            reader.readAsText(file);
        }

        // Exportar para Excel
        async function exportToExcel(range = 'all') {
            try {
                // Mostrar loader
                const loader = document.getElementById('exportLoader');
                loader.style.display = 'block';
                
                // Filtrar itens
                let filteredTools = tools;
                
                if (range === 'available') {
                    filteredTools = tools.filter(tool => tool.status === 'Dispon√≠vel');
                } else if (range === 'inuse') {
                    filteredTools = tools.filter(tool => tool.status === 'Em Uso');
                } else if (range === 'maintenance') {
                    filteredTools = tools.filter(tool => tool.status === 'Manuten√ß√£o');
                } else if (range === 'lowstock') {
                    filteredTools = tools.filter(tool => {
                        const quantidade = parseInt(tool.quantidade) || 0;
                        const estoqueMinimo = parseInt(tool.estoqueMinimo) || 0;
                        return estoqueMinimo > 0 && quantidade <= estoqueMinimo;
                    });
                }
                
                if (filteredTools.length === 0) {
                    loader.style.display = 'none';
                    showNotification('Nenhum item para exportar!', 'error');
                    return;
                }
                
                // Preparar dados
                const exportData = filteredTools.map(tool => ({
                    'C√≥digo': tool.code,
                    'Nome do Produto': tool.name,
                    'Patrim√¥nio': tool.patrimonio || '',
                    'N.C.M.': tool.ncm,
                    'Categoria': tool.category,
                    'Status': tool.status,
                    'Localiza√ß√£o': tool.location,
                    'Condi√ß√£o': tool.condition,
                    'Nota Fiscal': tool.notaFiscal || '',
                    'Unidade': tool.unidade || 'UN',
                    'Pre√ßo': tool.preco ? parseFloat(tool.preco).toFixed(2) : '0.00',
                    'Quantidade': tool.quantidade || 1,
                    'Estoque M√≠nimo': tool.estoqueMinimo || 0,
                    'Estoque M√°ximo': tool.estoqueMaximo || 0,
                    'Descri√ß√£o': tool.description || '',
                    'Observa√ß√µes': tool.observations || '',
                    'Data Cadastro': tool.dataCadastro || ''
                }));
                
                // Criar worksheet
                const ws = XLSX.utils.json_to_sheet(exportData);
                
                // Criar workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ferramentas');
                
                // Ajustar largura das colunas
                const wscols = [
                    { wch: 15 }, { wch: 30 }, { wch: 20 }, { wch: 15 }, { wch: 20 },
                    { wch: 15 }, { wch: 20 }, { wch: 15 }, { wch: 20 }, { wch: 10 },
                    { wch: 15 }, { wch: 10 }, { wch: 15 }, { wch: 15 }, { wch: 40 },
                    { wch: 40 }, { wch: 15 }
                ];
                ws['!cols'] = wscols;
                
                // Gerar nome do arquivo
                const fileName = `ferramentas_${range}_${new Date().toISOString().slice(0, 10)}.xlsx`;
                
                // Salvar arquivo
                XLSX.writeFile(wb, fileName);
                
                // Adicionar ao hist√≥rico
                addToExportHistory(range, filteredTools.length);
                
                showNotification(`${filteredTools.length} itens exportados!`, 'success');
                
            } catch (error) {
                console.error('Erro ao exportar Excel:', error);
                showNotification('Erro ao exportar.', 'error');
            } finally {
                document.getElementById('exportLoader').style.display = 'none';
            }
        }

        function addToExportHistory(range, count) {
            const exportHistory = document.getElementById('exportHistory');
            if (!exportHistory) return;
            
            const rangeText = {
                'all': 'Todos os itens',
                'available': 'Itens dispon√≠veis',
                'inuse': 'Itens em uso',
                'maintenance': 'Itens em manuten√ß√£o',
                'lowstock': 'Itens com estoque baixo'
            }[range] || range;
            
            const historyItem = document.createElement('div');
            historyItem.style.cssText = `
                display: flex; justify-content: space-between; align-items: center;
                padding: 15px; border-bottom: 1px solid var(--border-color);
            `;
            
            historyItem.innerHTML = `
                <div>
                    <p style="font-weight: 500; margin-bottom: 5px;">${rangeText}</p>
                    <p style="font-size: 14px; color: var(--gray-color);">${count} itens exportados</p>
                </div>
                <div>
                    <span class="status-badge status-ontrack">Excel</span>
                    <p style="font-size: 14px; color: var(--gray-color); margin-top: 5px;">${new Date().toLocaleString('pt-BR')}</p>
                </div>
            `;
            
            if (exportHistory.querySelector('p')) {
                exportHistory.innerHTML = '';
            }
            
            exportHistory.insertBefore(historyItem, exportHistory.firstChild);
        }

        // ============================================
        // EVENT LISTENERS (ATUALIZADOS)
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            // Verificar sess√£o ativa
            checkSession();
            
            // Configurar data atual no rodap√©
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('pt-BR');
            
            // ===== LOGIN =====
            document.getElementById('loginBtn').addEventListener('click', login);
            
            // Permitir login com Enter
            document.getElementById('loginPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
            
            // ===== LOGOUT =====
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // ===== TABS =====
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    if (tabId === 'catalogo') {
                        loadToolsList();
                    }
                    
                    if (tabId !== 'cadastro') {
                        isEditing = false;
                        editingToolId = null;
                        document.getElementById('saveToolBtn').innerHTML = '<i class="fas fa-save"></i> Salvar Item';
                    }
                });
            });
            
            // ===== BANCO DE DADOS =====
            document.getElementById('saveConfigBtn').addEventListener('click', async function() {
                // Verificar permiss√£o
                if (currentUser.role !== 'dev') {
                    showNotification('Apenas usu√°rios DEV podem configurar o banco de dados.', 'error');
                    return;
                }
                
                dbConfig.url = document.getElementById('supabaseUrl').value.trim();
                dbConfig.key = document.getElementById('supabaseKey').value.trim();
                
                localStorage.setItem('supabaseConfig', JSON.stringify(dbConfig));
                
                if (await setupSupabaseClient()) {
                    showNotification('Configura√ß√£o salva com sucesso!', 'success');
                }
            });
            
            document.getElementById('testConnectionBtn').addEventListener('click', async function() {
                if (!supabaseClient) {
                    showNotification('Configure as credenciais primeiro.', 'error');
                    return;
                }
                
                const result = await testSupabaseConnection();
                showNotification(result.message, result.success ? 'success' : 'error');
            });
            
            document.getElementById('createTableBtn').addEventListener('click', createTableInSupabase);
            
            document.getElementById('resetConfigBtn').addEventListener('click', function() {
                // Verificar permiss√£o
                if (currentUser.role !== 'dev') {
                    showNotification('Apenas usu√°rios DEV podem redefinir configura√ß√£o.', 'error');
                    return;
                }
                
                if (confirm('Redefinir configura√ß√£o do Supabase?')) {
                    localStorage.removeItem('supabaseConfig');
                    document.getElementById('supabaseUrl').value = '';
                    document.getElementById('supabaseKey').value = '';
                    supabaseClient = null;
                    isOnlineMode = false;
                    updateHeaderStats();
                    showNotification('Configura√ß√£o redefinida!', 'success');
                }
            });
            
            // ===== SINCRONIZA√á√ÉO =====
            document.getElementById('syncToOnlineBtn').addEventListener('click', syncToSupabase);
            document.getElementById('syncFromOnlineBtn').addEventListener('click', syncToSupabase); // Enviar para nuvem
            document.getElementById('syncFromOnlineBtn2').addEventListener('click', fetchFromSupabase);
            document.getElementById('syncBothBtn').addEventListener('click', async function() {
                await syncToSupabase();
                await fetchFromSupabase();
            });
            
            // ===== IMAGEM =====
            document.getElementById('captureImageBtn').addEventListener('click', function() {
                // Verificar permiss√£o
                if (currentUser.role === 'user') {
                    showNotification('Usu√°rio n√£o tem permiss√£o para adicionar imagens.', 'error');
                    return;
                }
                document.getElementById('imageUploadInput').click();
            });
            
            document.getElementById('uploadImageBtn').addEventListener('click', function() {
                // Verificar permiss√£o
                if (currentUser.role === 'user') {
                    showNotification('Usu√°rio n√£o tem permiss√£o para adicionar imagens.', 'error');
                    return;
                }
                document.getElementById('imageUploadInput').click();
            });
            
            document.getElementById('clearImageBtn').addEventListener('click', function() {
                // Verificar permiss√£o
                if (currentUser.role === 'user') {
                    showNotification('Usu√°rio n√£o tem permiss√£o para modificar imagens.', 'error');
                    return;
                }
                document.getElementById('cameraPlaceholder').style.display = 'block';
                document.getElementById('toolImagePreview').style.display = 'none';
                document.getElementById('toolImagePreview').src = '';
                currentToolImage = null;
            });
            
            document.getElementById('imageUploadInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.type.match('image.*')) {
                    showNotification('Selecione uma imagem!', 'error');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('A imagem √© muito grande. M√°ximo: 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentToolImage = event.target.result;
                    document.getElementById('cameraPlaceholder').style.display = 'none';
                    document.getElementById('toolImagePreview').style.display = 'block';
                    document.getElementById('toolImagePreview').src = currentToolImage;
                };
                reader.readAsDataURL(file);
                
                this.value = '';
            });
            
            // ===== FORMUL√ÅRIO =====
            document.getElementById('saveToolBtn').addEventListener('click', saveTool);
            
            document.getElementById('saveAndNewBtn').addEventListener('click', async function() {
                if (await saveTool()) {
                    clearForm();
                    if (document.getElementById('catalogo').classList.contains('active')) {
                        loadToolsList();
                    }
                }
            });
            
            document.getElementById('clearFormBtn').addEventListener('click', clearForm);
            
            document.getElementById('generateQRCodeBtn').addEventListener('click', function() {
                showNotification('Preencha o formul√°rio primeiro.', 'info');
            });
            
            // ===== FILTROS =====
            document.getElementById('filterAllBtn').addEventListener('click', () => loadToolsList('all'));
            document.getElementById('filterAvailableBtn').addEventListener('click', () => loadToolsList('available'));
            document.getElementById('filterInUseBtn').addEventListener('click', () => loadToolsList('inuse'));
            document.getElementById('filterLowStockBtn').addEventListener('click', () => loadToolsList('lowstock'));
            
            // ===== BUSCA =====
            document.getElementById('searchTool')?.addEventListener('input', () => loadToolsList());
            
            // ===== BACKUP =====
            document.getElementById('backupBtn').addEventListener('click', createBackup);
            document.getElementById('quickBackupBtn').addEventListener('click', createBackup);
            
            document.getElementById('restoreBtn').addEventListener('click', function() {
                // Verificar permiss√£o
                if (currentUser.role === 'user') {
                    showNotification('Usu√°rio n√£o tem permiss√£o para restaurar backup.', 'error');
                    return;
                }
                document.getElementById('restoreFileInput').click();
            });
            
            document.getElementById('restoreFileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.name.endsWith('.json')) {
                    showNotification('Selecione um arquivo JSON.', 'error');
                    return;
                }
                
                handleRestoreBackup(file);
                this.value = '';
            });
            
            // ===== EXPORTA√á√ÉO =====
            document.getElementById('exportExcelBtn').addEventListener('click', function() {
                const range = document.getElementById('exportRange').value;
                exportToExcel(range);
            });
            
            // ===== MODAIS =====
            document.getElementById('closeModalBtn').addEventListener('click', function() {
                document.getElementById('toolModal').style.display = 'none';
            });
            
            document.getElementById('closeQRModalBtn').addEventListener('click', function() {
                document.getElementById('qrModal').style.display = 'none';
            });
            
            document.getElementById('toolModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
            
            document.getElementById('qrModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
            
            // ===== LIMPAR CACHE =====
            document.getElementById('clearCacheBtn').addEventListener('click', async function() {
                // Verificar permiss√£o
                if (currentUser.role === 'user') {
                    showNotification('Usu√°rio n√£o tem permiss√£o para limpar cache.', 'error');
                    return;
                }
                
                if (confirm('Limpar todos os dados locais? Esta a√ß√£o n√£o pode ser desfeita.')) {
                    localStorage.removeItem('tools');
                    tools = getExampleTools();
                    await saveTools();
                    updateInterface();
                    showNotification('Dados locais limpos!', 'success');
                }
            });
            
            // ===== OTIMIZAR =====
            document.getElementById('optimizeStorageBtn').addEventListener('click', function() {
                showNotification('Sistema otimizado!', 'success');
            });
        });
    </script>
</body>
</html>